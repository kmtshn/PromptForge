<!doctype html>

<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PromptForge</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#121a33;
      --card2:#0f1630;
      --text:#e8ecff;
      --muted:#aab3d6;
      --line:rgba(255,255,255,.12);
      --accent:#7c5cff;
      --accent2:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 700px at 10% 10%, rgba(124,92,255,.25), transparent 55%),
        radial-gradient(1000px 600px at 90% 20%, rgba(34,197,94,.18), transparent 60%),
        radial-gradient(900px 500px at 50% 95%, rgba(245,158,11,.12), transparent 65%),
        var(--bg);
      color:var(--text);
    }
    header{
      padding:28px 18px 12px;
      max-width:1200px;
      margin:0 auto;
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .brand{
      display:flex; gap:12px; align-items:center;
    }
    .logo{
      width:46px; height:46px; border-radius:14px;
      background:
        linear-gradient(135deg, rgba(124,92,255,.95), rgba(34,197,94,.85));
      box-shadow: var(--shadow);
      display:grid; place-items:center;
      font-size:24px;
    }
    h1{ margin:0; font-size:20px; letter-spacing:.02em;}
    .sub{ margin:4px 0 0; color:var(--muted); font-size:13px; line-height:1.45;}
    .top-actions{ display:flex; gap:10px; flex-wrap:wrap; }
    button, .btn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      transition:.15s transform, .15s background, .15s border;
      font-weight:600;
      letter-spacing:.01em;
    }
    button:hover{ transform:translateY(-1px); background:rgba(255,255,255,.10); }
    button:active{ transform:translateY(0px); }
    .btn-accent{
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(124,92,255,.55));
      border-color: rgba(124,92,255,.65);
    }
    .btn-accent:hover{ background: linear-gradient(135deg, rgba(124,92,255,1), rgba(124,92,255,.65)); }
    .btn-green{
      background: linear-gradient(135deg, rgba(34,197,94,.95), rgba(34,197,94,.55));
      border-color: rgba(34,197,94,.65);
    }
    .btn-danger{
      background: linear-gradient(135deg, rgba(239,68,68,.95), rgba(239,68,68,.55));
      border-color: rgba(239,68,68,.65);
    }
    main{
      max-width:1200px;
      margin:0 auto;
      padding: 8px 18px 28px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .card .hd .ttl{
      font-weight:800;
      letter-spacing:.02em;
      display:flex; align-items:center; gap:8px;
    }
    .pill{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      color:var(--muted);
      background:rgba(0,0,0,.15);
      white-space:nowrap;
    }
    .card .bd{ padding:14px; }

    .row{
      display:grid;
      grid-template-columns: 160px 1fr;
      gap:10px;
      align-items:center;
      margin-bottom:10px;
    }
    @media (max-width: 560px){
      .row{ grid-template-columns: 1fr; }
    }
    label{
      color:var(--muted);
      font-size:13px;
      line-height:1.2;
    }
    select, input[type="text"], textarea{
      width:100%;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,.20);
      color: var(--text);
      padding: 10px 12px;
      outline: none;
      transition: .15s border, .15s background;
    }
    textarea{ min-height: 90px; resize: vertical; }
    select:focus, input:focus, textarea:focus{
      border-color: rgba(124,92,255,.7);
      background: rgba(0,0,0,.28);
    }
    .two{
      display:grid; grid-template-columns: 1fr 1fr; gap:10px;
    }
    @media (max-width: 560px){ .two{ grid-template-columns: 1fr; } }

    .hint{
      margin-top:6px;
      color:var(--muted);
      font-size:12px;
      line-height:1.55;
    }
    .divider{
      margin:12px 0;
      height:1px;
      background: var(--line);
    }
    .prompt{
      font-family: var(--mono);
      font-size: 12.8px;
      line-height: 1.65;
      white-space: pre-wrap;
      word-break: break-word;
      background: rgba(0,0,0,.22);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
      min-height: 280px;
    }
    .mini-actions{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .status{
      color:var(--muted);
      font-size:12px;
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center;
    }
    .toast{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 18px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,.55);
      box-shadow: var(--shadow);
      opacity: 0;
      pointer-events:none;
      transition: .18s opacity, .18s transform;
      color: var(--text);
      font-weight:700;
      z-index: 1000;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-2px);
    }
    .tag{
      display:inline-block;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      font-size: 12px;
      margin: 0 6px 6px 0;
    }
    .footer{
      max-width:1200px;
      margin: 14px auto 0;
      padding: 0 18px 22px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.6;
    }
    .kbd{
      font-family: var(--mono);
      border: 1px solid var(--line);
      padding: 2px 6px;
      border-radius: 8px;
      background: rgba(0,0,0,.22);
      color: var(--text);
      font-size: 11px;
    }

  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true">ğŸŒ</div>
      <div>
        <h1>ãƒŠãƒãƒãƒŠãƒŠã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆé›°å›²æ°—ç‰ˆï¼‰</h1>
        <p class="sub">
          ã½ã¡ã½ã¡é¸ã‚“ã§ â†’ æ—¥æœ¬èªã§ã‚³ã‚¢ã‚’æ›¸ã„ã¦ â†’ ã§ããŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒšã€‚<br/>
          å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã— / ã‚ªãƒ•ãƒ©ã‚¤ãƒ³OK / å…¥åŠ›ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«è‡ªå‹•ä¿å­˜ã€‚
        </p>
      </div>
    </div><div class="top-actions">
  <button class="btn-accent" id="btnCopyTop">ğŸ“‹ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
  <button id="btnRandom">ğŸ² ãã‚Œã£ã½ãåŸ‹ã‚ã‚‹</button>
  <button class="btn-danger" id="btnReset">ğŸ§¹ ãƒªã‚»ãƒƒãƒˆ</button>
</div>

  </header>  <main>
    <div class="grid">
      <!-- LEFT: Settings -->
      <section class="card">
        <div class="hd">
          <div class="ttl">ğŸ§© â‘  ã½ã¡ã½ã¡è¨­å®š</div>
          <div class="pill" id="presetPill">Preset: ã‚µãƒ ãƒ</div>
        </div>
        <div class="bd">
          <div class="row">
            <label for="purpose">ä½œã‚‹ã‚‚ã®</label>
            <select id="purpose">
              <option value="thumbnail">ã‚µãƒ ãƒï¼ˆYouTube/ãƒ–ãƒ­ã‚°ï¼‰</option>
              <option value="diagram">å›³è§£ï¼ˆ1æšã§è¦ç‚¹ï¼‰</option>
              <option value="compare">æ¯”è¼ƒå›³è§£ï¼ˆA/Bï¼‰</option>
              <option value="beforeAfter">Before / After</option>
              <option value="steps">ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆ1â†’2â†’3â€¦ï¼‰</option>
              <option value="comic4">4ã‚³ãƒæ¼«ç”»</option>
              <option value="banner">ãƒãƒŠãƒ¼</option>
            </select>
          </div><div class="two">
        <div class="row" style="margin-bottom:0;">
          <label for="ratio">æ¯”ç‡</label>
          <select id="ratio">
            <option value="16:9">16:9ï¼ˆæ¨ªï¼‰</option>
            <option value="1:1">1:1ï¼ˆã‚¹ã‚¯ã‚¨ã‚¢ï¼‰</option>
            <option value="9:16">9:16ï¼ˆç¸¦ï¼‰</option>
            <option value="4:3">4:3</option>
            <option value="3:2">3:2</option>
            <option value="21:9">21:9ï¼ˆã‚¦ãƒ«ãƒˆãƒ©ãƒ¯ã‚¤ãƒ‰ï¼‰</option>
          </select>
        </div>
        <div class="row" style="margin-bottom:0;">
          <label for="layout">ã‚¿ã‚¤ãƒˆãƒ«ä½ç½®</label>
          <select id="layout">
            <option value="top">ä¸Š</option>
            <option value="center">ä¸­å¤®</option>
            <option value="bottom">ä¸‹</option>
            <option value="left">å·¦ï¼ˆç¸¦çµ„ã¿ã‚‚å¯ï¼‰</option>
            <option value="right">å³</option>
          </select>
        </div>
      </div>

      <div class="divider"></div>

      <div class="row">
        <label for="style">ç”»é¢¨</label>
        <select id="style">
          <option value="corporate">ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ãƒˆï¼ˆæ¸…æ½”ãƒ»ä¿¡é ¼ï¼‰</option>
          <option value="flat">ãƒ•ãƒ©ãƒƒãƒˆå›³è§£ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰</option>
          <option value="pict">ãƒ”ã‚¯ãƒˆ/ã‚¢ã‚¤ã‚³ãƒ³å›³è§£</option>
          <option value="isometric">ã‚¢ã‚¤ã‚½ãƒ¡å›³è§£</option>
          <option value="cel">ã‚»ãƒ«å¡—ã‚Šã‚¢ãƒ‹ãƒ¡</option>
          <option value="pastel3d">3Dãƒ‘ã‚¹ãƒ†ãƒ«</option>
          <option value="loose">ã‚†ã‚‹ã„ã‚¤ãƒ©ã‚¹ãƒˆ</option>
          <option value="hand">æ‰‹æ›¸ãé¢¨</option>
        </select>
      </div>

      <div class="two">
        <div class="row" style="margin-bottom:0;">
          <label for="tone">ãƒˆãƒ¼ãƒ³</label>
          <select id="tone">
            <option value="business">ãƒ“ã‚¸ãƒã‚¹å¯„ã‚Šï¼ˆè½ã¡ç€ãï¼‰</option>
            <option value="friendly">è¦ªã—ã¿ï¼ˆã‚„ã‚ã‚‰ã‹ï¼‰</option>
            <option value="energetic">å‹¢ã„ï¼ˆå…ƒæ°—ï¼‰</option>
            <option value="luxury">é«˜ç´šæ„Ÿï¼ˆä¸Šå“ï¼‰</option>
          </select>
        </div>
        <div class="row" style="margin-bottom:0;">
          <label for="bg">èƒŒæ™¯</label>
          <select id="bg">
            <option value="white">ç™½ï¼ˆä½™ç™½å¤šã‚ï¼‰</option>
            <option value="lightGrad">è–„ã„ã‚°ãƒ©ãƒ‡</option>
            <option value="darkGrad">æ¿ƒã„ã‚ã‚°ãƒ©ãƒ‡</option>
            <option value="solid">å˜è‰²</option>
            <option value="photo">å†™çœŸ/ãƒªã‚¢ãƒ«èƒŒæ™¯</option>
          </select>
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <label for="color">é…è‰²</label>
        <select id="color">
          <option value="brand">ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼å„ªå…ˆ</option>
          <option value="mono">ãƒ¢ãƒãƒˆãƒ¼ãƒ³</option>
          <option value="pastel">ãƒ‘ã‚¹ãƒ†ãƒ«</option>
          <option value="vivid">ãƒ“ãƒ“ãƒƒãƒ‰</option>
          <option value="earth">ã‚¢ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼</option>
        </select>
      </div>

      <div class="row">
        <label for="textAmount">æ–‡å­—é‡</label>
        <select id="textAmount">
          <option value="short">å°‘ãªã‚ï¼ˆå¤§ããèª­ã¿ã‚„ã™ãï¼‰</option>
          <option value="mid">ä¸­ãã‚‰ã„</option>
          <option value="more">å¤šã‚ï¼ˆå›³è§£å‘ãï¼‰</option>
        </select>
      </div>

      <div class="row">
        <label for="quality">ä»•ä¸ŠãŒã‚Š</label>
        <select id="quality">
          <option value="clean">ã‚¯ãƒªãƒ¼ãƒ³ï¼ˆãƒã‚¤ã‚ºå°‘ï¼‰</option>
          <option value="rich">ãƒªãƒƒãƒï¼ˆæƒ…å ±é‡å¤šï¼‰</option>
          <option value="simple">ãƒŸãƒ‹ãƒãƒ«</option>
        </select>
      </div>

      <p class="hint">
        â€»ã€Œä½•ã‚’ä½œã‚‹ã‹ã€ã€Œæ¯”ç‡ã€ã€Œã‚¿ã‚¤ãƒˆãƒ«ä½ç½®ã€ã€Œãƒˆãƒ¼ãƒ³ã€ã€Œè‰²ã€ã‚ãŸã‚Šã‚’ã½ã¡ã½ã¡ã™ã‚‹æƒ³å®šã§ã™ã€‚<br/>
        è¶³ã‚Šãªã„æŒ‡å®šã¯AIãŒè£œå®Œã™ã‚‹å‰æã§OKã§ã™ã€‚
      </p>
    </div>
  </section>

  <!-- RIGHT: Core info + Output -->
  <section class="card">
    <div class="hd">
      <div class="ttl">âœï¸ â‘¡ ãƒ‡ã‚¶ã‚¤ãƒ³ã‚³ã‚¢ï¼ˆæ—¥æœ¬èªã§OKï¼‰</div>
      <div class="pill">è‡ªå‹•ä¿å­˜: ON</div>
    </div>
    <div class="bd">
      <div class="row">
        <label for="title">ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆå¤§è¦‹å‡ºã—ï¼‰</label>
        <input id="title" type="text" placeholder="ä¾‹ï¼‰3åˆ†ã§ã‚ã‹ã‚‹GASè‡ªå‹•åŒ– / å¤±æ•—ã—ãªã„ã‚µãƒ¼ãƒãƒ¼ãƒ©ãƒƒã‚¯ä½œæ¥­" />
      </div>

      <div class="row">
        <label for="subtitle">ã‚µãƒ–ã‚³ãƒ”ãƒ¼ï¼ˆä»»æ„ï¼‰</label>
        <input id="subtitle" type="text" placeholder="ä¾‹ï¼‰ç¾å ´ã§è©°ã¾ã‚ŠãŒã¡ãªãƒã‚¤ãƒ³ãƒˆã ã‘" />
      </div>

      <div class="two">
        <div class="row" style="margin-bottom:0;">
          <label for="audience">æƒ³å®šèª­è€…/è¦–è´è€…</label>
          <input id="audience" type="text" placeholder="ä¾‹ï¼‰æ–°äººCE / æƒ…ã‚·ã‚¹æ‹…å½“ / çµŒå–¶è€…" />
        </div>
        <div class="row" style="margin-bottom:0;">
          <label for="goal">è¦‹ã›ãŸã„å°è±¡</label>
          <input id="goal" type="text" placeholder="ä¾‹ï¼‰ä¿¡é ¼ãƒ»ç°¡å˜ãƒ»ã™ãä½¿ãˆã‚‹" />
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <label for="message">ä¼ãˆãŸã„è¦ç‚¹ï¼ˆç®‡æ¡æ›¸ãã§OKï¼‰</label>
        <textarea id="message" placeholder="ä¾‹ï¼‰

ãƒ»çµè«–ï¼šã¾ãšã“ã‚Œã ã‘ã‚„ã‚‹ ãƒ»å¤±æ•—ä¾‹ã¨å›é¿ç­– ãƒ»æ‰‹é † 1â†’2â†’3 ãƒ»æ³¨æ„ç‚¹ï¼ˆå®‰å…¨/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰"></textarea> </div>

<div class="two">
        <div class="row" style="margin-bottom:0;">
          <label for="characters">ç™»å ´äººç‰©/è¦ç´ </label>
          <input id="characters" type="text" placeholder="ä¾‹ï¼‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1äººã€PCã€ã‚µãƒ¼ãƒãƒ¼ãƒ©ãƒƒã‚¯ã€ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ" />
        </div>
        <div class="row" style="margin-bottom:0;">
          <label for="brandColor">ãƒ–ãƒ©ãƒ³ãƒ‰è‰²ï¼ˆä»»æ„ï¼‰</label>
          <input id="brandColor" type="text" placeholder="ä¾‹ï¼‰#4f46e5 / é’ç³»" />
        </div>
      </div>

      <div class="row" style="margin-top:10px;">
        <label for="constraints">åˆ¶ç´„/NGï¼ˆä»»æ„ï¼‰</label>
        <textarea id="constraints" placeholder="ä¾‹ï¼‰

ãƒ»æ–‡å­—ã¯èª­ã¿ã‚„ã™ãå¤ªå­— ãƒ»ä½™ç™½å¤šã‚ ãƒ»èƒŒæ™¯ã¯ç™½å¯„ã‚Š ãƒ»å°ã•ã„æ–‡å­—ã¯é¿ã‘ã‚‹ ãƒ»ç‰ˆæ¨©ã‚­ãƒ£ãƒ©ä¸å¯"></textarea> </div>

<div class="divider"></div>

      <div class="mini-actions">
        <button class="btn-accent" id="btnCopy">ğŸ“‹ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
        <button class="btn-green" id="btnDownload">ğŸ’¾ .txtã§ä¿å­˜</button>
        <button id="btnShorten">ğŸª„ æ–‡å­—é‡ã‚’åœ§ç¸®ï¼ˆé›°å›²æ°—ï¼‰</button>
      </div>

      <div class="status" style="margin-top:10px;">
        <span>æ–‡å­—æ•°: <b id="charCount">0</b></span>
        <span>æ¨å¥¨: <span class="kbd">ã‚¿ã‚¤ãƒˆãƒ«</span>ï¼‹<span class="kbd">è¦ç‚¹</span>ã ã‘ã§ã‚‚å¯</span>
        <span id="warnArea"></span>
      </div>

      <div class="divider"></div>

      <div class="hd" style="padding:0; border:none; margin-bottom:10px;">
        <div class="ttl" style="font-weight:900;">ğŸ§¾ â‘¢ å‡ºåŠ›ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆã‚³ãƒ”ãƒšç”¨ï¼‰</div>
        <div class="pill" id="modePill">Mode: æŒ‡ç¤ºãƒ†ãƒ³ãƒ—ãƒ¬</div>
      </div>

      <div class="prompt" id="promptOut" aria-label="ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ"></div>

      <div class="hint" style="margin-top:10px;">
        ä½¿ã„æ–¹ï¼šã“ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã¦ã€ç”ŸæˆçµæœãŒã‚ºãƒ¬ãŸã‚‰ <span class="kbd">åˆ¶ç´„</span> ã«ä¸€è¨€è¿½è¨˜ â†’ ã‚‚ã†ä¸€å›ã€ã®ãƒ«ãƒ¼ãƒ—ãŒæ—©ã„ã§ã™ã€‚
      </div>

      <div style="margin-top:10px;">
        <span class="tag">#ã‚µãƒ ãƒ</span>
        <span class="tag">#å›³è§£</span>
        <span class="tag">#æ¼«ç”»</span>
        <span class="tag">#ãƒãƒŠãƒ¼</span>
        <span class="tag">#æ—¥æœ¬èªã§OK</span>
      </div>
    </div>
  </section>
</div>

  </main>  <div class="footer">
    ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: <span class="kbd">Ctrl</span> + <span class="kbd">Enter</span> ã§ã‚³ãƒ”ãƒ¼ / <span class="kbd">Esc</span> ã§è­¦å‘Šè¡¨ç¤ºãƒªã‚»ãƒƒãƒˆ
  </div>  <div class="toast" id="toast">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</div><script>
(() => {
  const $ = (id) => document.getElementById(id);

  const els = {
    purpose: $("purpose"),
    ratio: $("ratio"),
    layout: $("layout"),
    style: $("style"),
    tone: $("tone"),
    bg: $("bg"),
    color: $("color"),
    textAmount: $("textAmount"),
    quality: $("quality"),

    title: $("title"),
    subtitle: $("subtitle"),
    audience: $("audience"),
    goal: $("goal"),
    message: $("message"),
    characters: $("characters"),
    brandColor: $("brandColor"),
    constraints: $("constraints"),

    presetPill: $("presetPill"),
    modePill: $("modePill"),
    promptOut: $("promptOut"),
    charCount: $("charCount"),
    warnArea: $("warnArea"),
    toast: $("toast"),

    btnCopy: $("btnCopy"),
    btnCopyTop: $("btnCopyTop"),
    btnReset: $("btnReset"),
    btnRandom: $("btnRandom"),
    btnDownload: $("btnDownload"),
    btnShorten: $("btnShorten"),
  };

  const STORAGE_KEY = "nanobanana_generator_vibe_v1";

  const dict = {
    purpose: {
      thumbnail: "ã‚µãƒ ãƒã‚¤ãƒ«ï¼ˆYouTube/ãƒ–ãƒ­ã‚°ï¼‰",
      diagram: "å›³è§£ï¼ˆ1æšã§è¦ç‚¹ï¼‰",
      compare: "æ¯”è¼ƒå›³è§£ï¼ˆA/Bï¼‰",
      beforeAfter: "Before/After å›³è§£",
      steps: "ã‚¹ãƒ†ãƒƒãƒ—å›³è§£ï¼ˆæ‰‹é †ï¼‰",
      comic4: "4ã‚³ãƒæ¼«ç”»",
      banner: "ãƒãƒŠãƒ¼ç”»åƒ",
    },
    layout: { top:"ä¸Š", center:"ä¸­å¤®", bottom:"ä¸‹", left:"å·¦", right:"å³" },
    tone: { business:"ãƒ“ã‚¸ãƒã‚¹å¯„ã‚Š", friendly:"è¦ªã—ã¿", energetic:"å‹¢ã„", luxury:"é«˜ç´šæ„Ÿ" },
    bg: { white:"ç™½", lightGrad:"è–„ã„ã‚°ãƒ©ãƒ‡", darkGrad:"æ¿ƒã„ã‚ã‚°ãƒ©ãƒ‡", solid:"å˜è‰²", photo:"å†™çœŸ/ãƒªã‚¢ãƒ«" },
    color: { brand:"ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼å„ªå…ˆ", mono:"ãƒ¢ãƒãƒˆãƒ¼ãƒ³", pastel:"ãƒ‘ã‚¹ãƒ†ãƒ«", vivid:"ãƒ“ãƒ“ãƒƒãƒ‰", earth:"ã‚¢ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼" },
    textAmount: { short:"å°‘ãªã‚", mid:"ä¸­ãã‚‰ã„", more:"å¤šã‚" },
    quality: { clean:"ã‚¯ãƒªãƒ¼ãƒ³", rich:"ãƒªãƒƒãƒ", simple:"ãƒŸãƒ‹ãƒãƒ«" },
    style: {
      corporate:"ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ãƒˆï¼ˆæ¸…æ½”ãƒ»ä¿¡é ¼ï¼‰",
      flat:"ãƒ•ãƒ©ãƒƒãƒˆå›³è§£ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰",
      pict:"ãƒ”ã‚¯ãƒˆ/ã‚¢ã‚¤ã‚³ãƒ³å›³è§£",
      isometric:"ã‚¢ã‚¤ã‚½ãƒ¡å›³è§£",
      cel:"ã‚»ãƒ«å¡—ã‚Šã‚¢ãƒ‹ãƒ¡",
      pastel3d:"3Dãƒ‘ã‚¹ãƒ†ãƒ«",
      loose:"ã‚†ã‚‹ã„ã‚¤ãƒ©ã‚¹ãƒˆ",
      hand:"æ‰‹æ›¸ãé¢¨",
    }
  };

  function toast(msg){
    els.toast.textContent = msg;
    els.toast.classList.add("show");
    setTimeout(()=>els.toast.classList.remove("show"), 1200);
  }

  function save(){
    const data = {};
    for(const k of Object.keys(els)){
      if(!els[k] || !("value" in els[k])) continue;
      data[k] = els[k].value;
    }
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  function load(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    try{
      const data = JSON.parse(raw);
      for(const [k,v] of Object.entries(data)){
        if(els[k] && ("value" in els[k])) els[k].value = v;
      }
    }catch(e){}
  }

  function recommendWarnings(){
    const t = els.title.value.trim();
    const m = els.message.value.trim();
    const p = els.purpose.value;

    let warns = [];
    if(!t) warns.push("ã‚¿ã‚¤ãƒˆãƒ«ãŒç©ºã§ã™");
    if(!m) warns.push("è¦ç‚¹ãŒç©ºã§ã™");
    if(p === "comic4" && !els.characters.value.trim()) warns.push("4ã‚³ãƒãªã‚‰ç™»å ´äººç‰©/è¦ç´ ãŒã‚ã‚‹ã¨å®‰å®šã—ã¾ã™");
    if((p === "compare" || p === "beforeAfter") && m.split("\n").filter(Boolean).length < 2) warns.push("æ¯”è¼ƒ/BeforeAfterã¯è¦ç‚¹ã‚’2è¡Œä»¥ä¸Šã«ã™ã‚‹ã¨å¼·ã„ã§ã™");
    if(els.textAmount.value === "more" && els.ratio.value === "16:9") warns.push("æ–‡å­—é‡å¤šã‚Ã—16:9 ã¯è©°ã¾ã‚Šã‚„ã™ã„ã®ã§ä½™ç™½/å›³å½¢ã§é€ƒãŒã™æŒ‡ç¤ºãŒãŠã™ã™ã‚ã§ã™");

    if(warns.length){
      els.warnArea.innerHTML = `âš ï¸ ${warns.join(" / ")}`;
      els.warnArea.style.color = "var(--warn)";
    }else{
      els.warnArea.textContent = "âœ… å…¥åŠ›OK";
      els.warnArea.style.color = "var(--accent2)";
    }
  }

  function buildPrompt(){
    const purpose = els.purpose.value;
    const ratio = els.ratio.value;
    const layout = els.layout.value;
    const style = els.style.value;
    const tone = els.tone.value;
    const bg = els.bg.value;
    const color = els.color.value;
    const textAmount = els.textAmount.value;
    const quality = els.quality.value;

    const title = els.title.value.trim() || "(ã‚¿ã‚¤ãƒˆãƒ«æœªå®š)";
    const subtitle = els.subtitle.value.trim();
    const audience = els.audience.value.trim() || "ä¸€èˆ¬";
    const goal = els.goal.value.trim() || "æƒ…å ±ã‚’åˆ†ã‹ã‚Šã‚„ã™ãä¼ãˆã‚‹";
    const message = els.message.value.trim() || "(ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœªå®š)";
    const characters = els.characters.value.trim();
    const brandColor = els.brandColor.value.trim();
    const constraints = els.constraints.value.trim();

    els.presetPill.textContent = `Preset: ${dict.purpose[purpose]}`;
    els.modePill.textContent = `Mode: ${dict.style[style]} / ${ratio}`;

    const purposeGuide = (() => {
      switch(purpose){
        case "thumbnail":
          return [
            "è¦–èªæ€§æœ€å„ªå…ˆã€‚ã‚¿ã‚¤ãƒˆãƒ«ã¯å¤§ããã€è¦ç´ ã¯å°‘ãªãã€å¼·ã„ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã§ã€‚",
            "é‡è¦å˜èªã‚’2ã€œ5èªã«çµã‚‹ã€‚å°ã•ã„æ–‡å­—ã¯é¿ã‘ã‚‹ã€‚",
            "ä½™ç™½ã‚’ç¢ºä¿ã—ã€èƒŒæ™¯ã¯ã†ã‚‹ã•ãã—ãªã„ã€‚"
          ].join("\n");
        case "diagram":
          return [
            "æƒ…å ±ã‚’æ•´ç†ã—ã¦ã€è¦‹å‡ºã—â†’è¦ç‚¹â†’è£œè¶³ã®é †ã§éšå±¤åŒ–ã€‚",
            "ã‚¢ã‚¤ã‚³ãƒ³/å›³å½¢/çŸ¢å°ã§ç†è§£ã‚’åŠ©ã‘ã‚‹ã€‚æ–‡ç« ã¯çŸ­ãã€‚",
          ].join("\n");
        case "compare":
          return [
            "Aã¨Bã‚’å·¦å³ã¾ãŸã¯ä¸Šä¸‹ã§å¯¾æ¯”ã€‚å·®åˆ†ãŒä¸€ç›®ã§ã‚ã‹ã‚‹æ§‹æˆã€‚",
            "æ¯”è¼ƒè»¸ã‚’2ã€œ4å€‹ã«çµã£ã¦å›³è§£åŒ–ã€‚",
          ].join("\n");
        case "beforeAfter":
          return [
            "Beforeã¨Afterã‚’æ˜ç¢ºã«åˆ†é›¢ã—ã€å¤‰åŒ–ç‚¹ã‚’å¼·èª¿ã€‚",
            "çŸ¢å°ã‚„ãƒã‚¤ãƒ©ã‚¤ãƒˆã§ã€Œã©ã“ãŒã©ã†è‰¯ããªã‚‹ã‹ã€ã‚’è¦‹ã›ã‚‹ã€‚",
          ].join("\n");
        case "steps":
          return [
            "1â†’2â†’3â€¦ã®æµã‚ŒãŒè¿·å­ã«ãªã‚‰ãªã„ã‚ˆã†ã€ç•ªå·ãƒ»çŸ¢å°ã§èª˜å°ã€‚",
            "å„ã‚¹ãƒ†ãƒƒãƒ—ã¯çŸ­æ–‡ï¼‹ã‚¢ã‚¤ã‚³ãƒ³ã§ã€‚",
          ].join("\n");
        case "comic4":
          return [
            "4ã‚³ãƒæ§‹æˆï¼ˆèµ·â†’æ‰¿â†’è»¢â†’çµï¼‰ã€‚ã‚ªãƒã¯æœ€å¾Œã«ã€‚",
            "ã‚»ãƒªãƒ•ã¯çŸ­ãã€è¡¨æƒ…ã§æ„Ÿæƒ…ãŒä¼ã‚ã‚‹ã‚ˆã†ã«ã€‚",
          ].join("\n");
        case "banner":
          return [
            "æ¨ªé•·ãƒãƒŠãƒ¼æƒ³å®šã€‚ä½™ç™½ãƒ»è¦–èªæ€§ãƒ»CTAï¼ˆä»»æ„ï¼‰ã‚’æ„è­˜ã€‚",
            "æƒ…å ±ã¯æœ€å°ã€‚ä¸»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸1æœ¬ï¼‹è£œåŠ©1æœ¬ã¾ã§ã€‚",
          ].join("\n");
        default:
          return "";
      }
    })();

    const titlePos = (() => {
      const map = {
        top: "ã‚¿ã‚¤ãƒˆãƒ«ã¯ä¸Šéƒ¨ã«é…ç½®",
        center: "ã‚¿ã‚¤ãƒˆãƒ«ã¯ä¸­å¤®ã«é…ç½®ï¼ˆæœ€å„ªå…ˆã§ç›®ç«‹ãŸã›ã‚‹ï¼‰",
        bottom: "ã‚¿ã‚¤ãƒˆãƒ«ã¯ä¸‹éƒ¨ã«é…ç½®ï¼ˆäººç‰©/ä¸»å½¹ã®é‚ªé­”ã‚’ã—ãªã„ï¼‰",
        left: "ã‚¿ã‚¤ãƒˆãƒ«ã¯å·¦å´ï¼ˆç¸¦çµ„ã¿ã‚‚å¯ï¼‰ã«é…ç½®",
        right: "ã‚¿ã‚¤ãƒˆãƒ«ã¯å³å´ã«é…ç½®"
      };
      return map[layout] || "ã‚¿ã‚¤ãƒˆãƒ«ä½ç½®ã¯é©åˆ‡ã«";
    })();

    const colorLine = (() => {
        let s = `é…è‰²ã¯ã€Œ${dict.color[color]}ã€åŸºèª¿ã€‚`;
        if(brandColor) s += ` ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼ï¼ˆ${brandColor}ï¼‰ã‚’ã‚¢ã‚¯ã‚»ãƒ³ãƒˆã«ä½¿ç”¨ã€‚`;
        return s;
    })();

    const finalPrompt = `
# ç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæŒ‡ç¤ºæ›¸

## â‘  åˆ¶ä½œã®ç›®çš„ãƒ»å½¢å¼
- **ç¨®é¡**: ${dict.purpose[purpose]}
- **ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”**: ${ratio}
- **åŸºæœ¬æ–¹é‡**:
${purposeGuide}

## â‘¡ ãƒ‡ã‚¶ã‚¤ãƒ³ã‚³ã‚¢ï¼ˆå†…å®¹ï¼‰
- **ã‚¿ã‚¤ãƒˆãƒ«**: ${title}
${subtitle ? `- **ã‚µãƒ–ã‚³ãƒ”ãƒ¼**: ${subtitle}` : ""}
- **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ**: ${audience}
- **ç‹™ã†å°è±¡**: ${goal}
- **ä¸»ãªå†…å®¹/ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸**:
${message}
${characters ? `- **ç™»å ´äººç‰©/è¦ç´ **: ${characters}` : ""}

## â‘¢ ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ†ã‚¤ã‚¹ãƒˆï¼ˆè¦‹ãŸç›®ï¼‰
- **ç”»é¢¨**: ${dict.style[style]}
- **ãƒˆãƒ¼ãƒ³**: ${dict.tone[tone]}
- **èƒŒæ™¯**: ${dict.bg[bg]}
- **é…è‰²**: ${colorLine}
- **æ–‡å­—é‡**: ${dict.textAmount[textAmount]}
- **å“è³ª**: ${dict.quality[quality]}
- **ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ**: ${titlePos}

${constraints ? `## â‘£ åˆ¶ç´„ãƒ»NGäº‹é …\n${constraints}` : ""}

## â‘¤ AIã¸ã®æŒ‡ç¤º
ä¸Šè¨˜ã®å†…å®¹ã‚’è¸ã¾ãˆã€è¦–èªæ€§ãŒé«˜ãã€ãƒ—ãƒ­ãƒ•ã‚§ãƒƒã‚·ãƒ§ãƒŠãƒ«ãªãƒ‡ã‚¶ã‚¤ãƒ³ã®ç”»åƒã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚
æ–‡å­—ï¼ˆç‰¹ã«æ—¥æœ¬èªï¼‰ãŒå«ã¾ã‚Œã‚‹å ´åˆã¯ã€å¯èƒ½ãªé™ã‚Šæ­£ç¢ºã«ã€ã‚ã‚‹ã„ã¯å¾Œã‹ã‚‰ç·¨é›†ã—ã‚„ã™ã„é…ç½®ã§æå†™ã—ã¦ãã ã•ã„ã€‚
`.trim();

    els.promptOut.textContent = finalPrompt;
    
    // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ (ã‚¿ã‚¤ãƒˆãƒ«+è¦ç‚¹+åˆ¶ç´„)
    const count = title.length + message.length + (constraints ? constraints.length : 0);
    els.charCount.textContent = count;
  }

  // --- Actions ---

  function copyToClipboard(){
    const text = els.promptOut.textContent;
    if(!text) return;
    
    // iframeå†…ã§ã®ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰å¯¾å¿œ
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    try{
        document.execCommand('copy');
        toast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
    } catch(err){
        toast("ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ");
    }
    document.body.removeChild(ta);
  }

  function resetAll(){
    if(!confirm("æœ¬å½“ã«å…¥åŠ›ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ")) return;
    localStorage.removeItem(STORAGE_KEY);
    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«æˆ»ã™ï¼ˆç°¡æ˜“çš„ãƒªãƒ­ãƒ¼ãƒ‰ï¼‰
    location.reload();
  }

  function randomFill(){
    // é¸æŠè‚¢ã‚’ãƒ©ãƒ³ãƒ€ãƒ ã«
    const selects = document.querySelectorAll("select");
    selects.forEach(sel => {
      const opts = sel.options;
      sel.selectedIndex = Math.floor(Math.random() * opts.length);
    });
    
    // å…¥åŠ›ãŒç©ºãªã‚‰ã‚µãƒ³ãƒ—ãƒ«ã‚’å…¥ã‚Œã‚‹ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ï¼‰
    if(!els.title.value) els.title.value = "AIæ™‚ä»£ã®ç”Ÿå­˜æˆ¦ç•¥";
    if(!els.audience.value) els.audience.value = "20ä»£ã€œ30ä»£ã®ãƒ“ã‚¸ãƒã‚¹ãƒ‘ãƒ¼ã‚½ãƒ³";
    if(!els.goal.value) els.goal.value = "å±æ©Ÿæ„Ÿã‚’æŒãŸã›ã¤ã¤ã€å¸Œæœ›ã‚‚è¦‹ã›ã‚‹";
    if(!els.message.value) els.message.value = "ãƒ»AIã¯é“å…·ã§ã‚ã‚‹\nãƒ»ä½¿ã†å´ã«ãªã‚Œã°æ€–ããªã„\nãƒ»ã¾ãšã¯è§¦ã£ã¦ã¿ã‚ˆã†";

    toast("ğŸ² ãƒ©ãƒ³ãƒ€ãƒ ã«è¨­å®šã—ã¾ã—ãŸ");
    buildPrompt();
    save();
    recommendWarnings();
  }
  
  function downloadTxt(){
      const text = els.promptOut.textContent;
      const blob = new Blob([text], { type: 'text/plain' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `prompt_${new Date().toISOString().slice(0,10)}.txt`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      toast("ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹ã—ã¾ã—ãŸ");
  }

  function shortenText(){
      // ç°¡æ˜“çš„ãªã€ŒçŸ­ç¸®ã€ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
      if(els.message.value.length > 10){
          toast("ğŸª„ é›°å›²æ°—ã‚’æ®‹ã—ã¦çŸ­ç¸®ã—ã¾ã—ãŸï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰");
          // å®Ÿéš›ã«ã¯è¦ç´„APIãŒå¿…è¦ã ãŒã€ã“ã“ã§ã¯æ”¹è¡Œã‚’æ•´ç†ã™ã‚‹ç¨‹åº¦
          const lines = els.message.value.split('\n').filter(l => l.trim().length > 0);
          els.message.value = lines.join('\n');
          buildPrompt();
      } else {
          toast("ã“ã‚Œä»¥ä¸ŠçŸ­ãã§ãã¾ã›ã‚“");
      }
  }

  // --- Init ---

  // Event Listeners
  [els.btnCopy, els.btnCopyTop].forEach(btn => btn.addEventListener("click", copyToClipboard));
  els.btnReset.addEventListener("click", resetAll);
  els.btnRandom.addEventListener("click", randomFill);
  els.btnDownload.addEventListener("click", downloadTxt);
  els.btnShorten.addEventListener("click", shortenText);

  // Inputs
  const inputEvents = ["input", "change"];
  Object.values(els).forEach(el => {
    if(el && (el.tagName === "INPUT" || el.tagName === "SELECT" || el.tagName === "TEXTAREA")){
      inputEvents.forEach(evt => {
        el.addEventListener(evt, () => {
          buildPrompt();
          save();
          recommendWarnings();
        });
      });
    }
  });

  // Shortcut keys
  document.addEventListener("keydown", (e) => {
    if((e.ctrlKey || e.metaKey) && e.key === "Enter"){
      e.preventDefault();
      copyToClipboard();
    }
    if(e.key === "Escape"){
      els.warnArea.innerHTML = "";
    }
  });

  // Start
  load();
  buildPrompt();
  recommendWarnings();

})();
</script>
</body>
</html>
