<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PromptForge - AIç”»åƒç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼</title>
  <style>
    :root {
      --bg-start: #fef9ff;
      --bg-mid: #f5f0ff;
      --bg-end: #fff5f5;
      --card: rgba(255, 255, 255, 0.85);
      --card-border: rgba(255, 255, 255, 0.6);
      --card-shadow: 0 8px 32px rgba(147, 112, 219, 0.15);
      --text: #2d2d3a;
      --text-muted: #6b6b80;
      --accent-primary: #8b5cf6;
      --accent-secondary: #ec4899;
      --accent-tertiary: #f97316;
      --accent-success: #10b981;
      --accent-warning: #f59e0b;
      --accent-danger: #ef4444;
      --gradient-primary: linear-gradient(135deg, #8b5cf6, #ec4899);
      --gradient-secondary: linear-gradient(135deg, #ec4899, #f97316);
      --gradient-success: linear-gradient(135deg, #10b981, #34d399);
      --input-bg: rgba(255, 255, 255, 0.9);
      --input-border: rgba(139, 92, 246, 0.2);
      --input-focus: rgba(139, 92, 246, 0.5);
      --line: rgba(139, 92, 246, 0.15);
      --radius: 16px;
      --radius-sm: 12px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: 'Inter', ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans JP", sans-serif;
    }

    .dark-mode {
      --bg-start: #0f0a1a;
      --bg-mid: #1a1025;
      --bg-end: #150d1a;
      --card: rgba(30, 20, 45, 0.9);
      --card-border: rgba(139, 92, 246, 0.2);
      --card-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
      --text: #f0e6ff;
      --text-muted: #a89cc4;
      --input-bg: rgba(20, 15, 35, 0.9);
      --input-border: rgba(139, 92, 246, 0.3);
      --line: rgba(139, 92, 246, 0.2);
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    
    body {
      font-family: var(--sans);
      background: 
        radial-gradient(ellipse 120% 80% at 10% 20%, rgba(139, 92, 246, 0.15), transparent 50%),
        radial-gradient(ellipse 100% 60% at 90% 10%, rgba(236, 72, 153, 0.12), transparent 50%),
        radial-gradient(ellipse 80% 50% at 50% 90%, rgba(249, 115, 22, 0.1), transparent 50%),
        linear-gradient(180deg, var(--bg-start), var(--bg-mid), var(--bg-end));
      min-height: 100vh;
      color: var(--text);
      transition: background 0.3s, color 0.3s;
    }

    /* Header */
    header {
      padding: 24px 24px 16px;
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      gap: 16px;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
    }

    .brand {
      display: flex;
      gap: 16px;
      align-items: center;
    }

    .logo {
      width: 56px;
      height: 56px;
      border-radius: 16px;
      background: var(--gradient-primary);
      display: grid;
      place-items: center;
      font-size: 28px;
      box-shadow: 
        0 4px 20px rgba(139, 92, 246, 0.4),
        0 0 40px rgba(139, 92, 246, 0.2);
      animation: glow 3s ease-in-out infinite alternate;
      position: relative;
      overflow: hidden;
    }

    .logo::before {
      content: '';
      position: absolute;
      inset: -2px;
      background: var(--gradient-secondary);
      border-radius: 18px;
      z-index: -1;
      animation: rotate 4s linear infinite;
    }

    @keyframes glow {
      0% { box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4), 0 0 40px rgba(139, 92, 246, 0.2); }
      100% { box-shadow: 0 4px 30px rgba(236, 72, 153, 0.5), 0 0 60px rgba(236, 72, 153, 0.3); }
    }

    @keyframes rotate {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .brand-text h1 {
      font-size: 24px;
      font-weight: 800;
      background: var(--gradient-primary);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      letter-spacing: -0.02em;
    }

    .brand-text .tagline {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 4px;
      line-height: 1.5;
    }

    .top-actions {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items: center;
    }

    /* Buttons */
    button, .btn {
      border: 1px solid var(--input-border);
      background: var(--card);
      color: var(--text);
      padding: 12px 18px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-weight: 600;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: all 0.2s ease;
      backdrop-filter: blur(10px);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 16px rgba(139, 92, 246, 0.2);
    }

    button:active { transform: translateY(0); }

    .btn-primary {
      background: var(--gradient-primary);
      border: none;
      color: white;
      box-shadow: 0 4px 16px rgba(139, 92, 246, 0.3);
    }

    .btn-primary:hover {
      box-shadow: 0 6px 24px rgba(139, 92, 246, 0.4);
      filter: brightness(1.1);
    }

    .btn-success {
      background: var(--gradient-success);
      border: none;
      color: white;
      box-shadow: 0 4px 16px rgba(16, 185, 129, 0.3);
    }

    .btn-danger {
      background: linear-gradient(135deg, var(--accent-danger), #f87171);
      border: none;
      color: white;
    }

    .btn-icon {
      width: 44px;
      height: 44px;
      padding: 0;
      justify-content: center;
      font-size: 18px;
    }

    /* Main Layout */
    main {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 24px 32px;
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    @media (max-width: 1024px) {
      .grid { grid-template-columns: 1fr; }
    }

    /* Cards */
    .card {
      background: var(--card);
      border: 1px solid var(--card-border);
      border-radius: var(--radius);
      box-shadow: var(--card-shadow);
      backdrop-filter: blur(20px);
      overflow: hidden;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .card:hover {
      box-shadow: 0 12px 40px rgba(139, 92, 246, 0.2);
    }

    .card-header {
      padding: 18px 20px;
      border-bottom: 1px solid var(--line);
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(236, 72, 153, 0.05));
    }

    .card-title {
      font-weight: 700;
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-title .step {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      background: var(--gradient-primary);
      color: white;
      font-size: 13px;
      font-weight: 700;
      display: grid;
      place-items: center;
    }

    .card-body { padding: 20px; }

    /* Form Elements */
    .form-group {
      margin-bottom: 16px;
    }

    .form-row {
      display: grid;
      grid-template-columns: 140px 1fr;
      gap: 12px;
      align-items: center;
    }

    @media (max-width: 600px) {
      .form-row { grid-template-columns: 1fr; }
    }

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
    }

    @media (max-width: 600px) {
      .form-grid { grid-template-columns: 1fr; }
    }

    label {
      font-size: 13px;
      font-weight: 600;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      gap: 6px;
    }

    label .icon {
      font-size: 16px;
    }

    select, input[type="text"], input[type="range"], textarea {
      width: 100%;
      border-radius: var(--radius-sm);
      border: 2px solid var(--input-border);
      background: var(--input-bg);
      color: var(--text);
      padding: 12px 14px;
      font-size: 14px;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
    }

    select:focus, input[type="text"]:focus, textarea:focus {
      border-color: var(--accent-primary);
      box-shadow: 0 0 0 4px rgba(139, 92, 246, 0.1);
    }

    textarea { 
      min-height: 100px; 
      resize: vertical;
      line-height: 1.6;
    }

    select {
      cursor: pointer;
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%236b6b80' d='M6 8L1 3h10z'/%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 14px center;
      padding-right: 36px;
    }

    /* Range Slider */
    .range-wrapper {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    input[type="range"] {
      -webkit-appearance: none;
      height: 8px;
      border-radius: 4px;
      background: var(--line);
      border: none;
      padding: 0;
    }

    input[type="range"]::-webkit-slider-thumb {
      -webkit-appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: var(--gradient-primary);
      cursor: pointer;
      box-shadow: 0 2px 8px rgba(139, 92, 246, 0.4);
    }

    .range-value {
      min-width: 36px;
      text-align: center;
      font-weight: 700;
      font-size: 14px;
      color: var(--accent-primary);
    }

    /* Pills & Tags */
    .pill {
      font-size: 12px;
      padding: 6px 12px;
      border-radius: 999px;
      background: rgba(139, 92, 246, 0.1);
      color: var(--accent-primary);
      font-weight: 600;
      white-space: nowrap;
    }

    .tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 8px 14px;
      border-radius: 999px;
      border: 2px solid var(--line);
      background: var(--card);
      color: var(--text-muted);
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      margin: 0 8px 8px 0;
    }

    .tag:hover {
      border-color: var(--accent-primary);
      color: var(--accent-primary);
      background: rgba(139, 92, 246, 0.1);
    }

    .tag.active {
      border-color: var(--accent-primary);
      background: var(--gradient-primary);
      color: white;
    }

    /* Quick Presets */
    .preset-grid {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }

    .preset-btn {
      padding: 8px 14px;
      border-radius: 999px;
      border: 2px solid var(--line);
      background: transparent;
      color: var(--text-muted);
      font-size: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .preset-btn:hover {
      border-color: var(--accent-secondary);
      color: var(--accent-secondary);
      transform: translateY(-1px);
    }

    .preset-btn.active {
      background: var(--gradient-secondary);
      border-color: transparent;
      color: white;
    }

    /* Divider */
    .divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--line), transparent);
      margin: 20px 0;
    }

    /* Prompt Output */
    .prompt-output {
      font-family: var(--mono);
      font-size: 13px;
      line-height: 1.7;
      white-space: pre-wrap;
      word-break: break-word;
      background: linear-gradient(135deg, rgba(139, 92, 246, 0.05), rgba(236, 72, 153, 0.05));
      border: 2px solid var(--line);
      border-radius: var(--radius);
      padding: 16px;
      min-height: 300px;
      max-height: 500px;
      overflow-y: auto;
    }

    /* Status Bar */
    .status-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
      margin-top: 16px;
      padding: 12px 16px;
      background: rgba(139, 92, 246, 0.05);
      border-radius: var(--radius-sm);
    }

    .status-item {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 13px;
      color: var(--text-muted);
    }

    .status-item strong {
      color: var(--text);
    }

    .status-ok { color: var(--accent-success); }
    .status-warn { color: var(--accent-warning); }

    /* Actions Bar */
    .actions-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 16px;
    }

    /* Hint Text */
    .hint {
      font-size: 12px;
      color: var(--text-muted);
      line-height: 1.6;
      margin-top: 8px;
      padding: 10px 14px;
      background: rgba(139, 92, 246, 0.05);
      border-radius: var(--radius-sm);
      border-left: 3px solid var(--accent-primary);
    }

    /* History Panel */
    .history-panel {
      margin-top: 16px;
      padding: 16px;
      background: rgba(0, 0, 0, 0.03);
      border-radius: var(--radius-sm);
      border: 1px solid var(--line);
    }

    .dark-mode .history-panel {
      background: rgba(255, 255, 255, 0.03);
    }

    .history-title {
      font-size: 13px;
      font-weight: 700;
      color: var(--text-muted);
      margin-bottom: 10px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .history-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
      max-height: 150px;
      overflow-y: auto;
    }

    .history-item {
      padding: 10px 12px;
      background: var(--card);
      border-radius: var(--radius-sm);
      font-size: 12px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .history-item:hover {
      background: rgba(139, 92, 246, 0.1);
    }

    .history-item-title {
      font-weight: 600;
      color: var(--text);
    }

    .history-item-meta {
      color: var(--text-muted);
      font-size: 11px;
    }

    /* Toast */
    .toast {
      position: fixed;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      bottom: 24px;
      padding: 14px 24px;
      border-radius: var(--radius);
      background: var(--gradient-primary);
      color: white;
      font-weight: 700;
      font-size: 14px;
      box-shadow: 0 8px 32px rgba(139, 92, 246, 0.4);
      opacity: 0;
      pointer-events: none;
      transition: all 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
      z-index: 1000;
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }

    /* Footer */
    .footer {
      max-width: 1400px;
      margin: 0 auto;
      padding: 16px 24px 32px;
      color: var(--text-muted);
      font-size: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 12px;
    }

    .kbd {
      font-family: var(--mono);
      font-size: 11px;
      padding: 4px 8px;
      border-radius: 6px;
      background: rgba(139, 92, 246, 0.1);
      border: 1px solid var(--line);
      color: var(--text);
    }

    /* Section Headers */
    .section-header {
      font-size: 13px;
      font-weight: 700;
      color: var(--accent-primary);
      margin-bottom: 12px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--line);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Dark Mode Toggle */
    .theme-toggle {
      position: relative;
      width: 60px;
      height: 32px;
      border-radius: 999px;
      background: var(--line);
      border: none;
      cursor: pointer;
      padding: 4px;
      transition: background 0.3s;
    }

    .theme-toggle::after {
      content: 'â˜€ï¸';
      position: absolute;
      left: 4px;
      top: 50%;
      transform: translateY(-50%);
      width: 24px;
      height: 24px;
      border-radius: 50%;
      background: white;
      display: grid;
      place-items: center;
      font-size: 14px;
      transition: all 0.3s;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    }

    .dark-mode .theme-toggle {
      background: var(--accent-primary);
    }

    .dark-mode .theme-toggle::after {
      content: 'ğŸŒ™';
      left: calc(100% - 28px);
    }

    /* Animations */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .card {
      animation: fadeIn 0.4s ease-out;
    }

    .card:nth-child(2) {
      animation-delay: 0.1s;
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true">âš¡</div>
      <div class="brand-text">
        <h1>PromptForge</h1>
        <p class="tagline">
          AIç”»åƒç”Ÿæˆã®ãŸã‚ã®æœ€å¼·ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ“ãƒ«ãƒ€ãƒ¼<br/>
          é¸ã¶ â†’ æ›¸ã â†’ ã‚³ãƒ”ãƒšã§å®Œæˆï¼
        </p>
      </div>
    </div>

    <div class="top-actions">
      <button class="btn-primary" id="btnCopyTop">
        <span>ğŸ“‹</span> ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼
      </button>
      <button id="btnRandom">
        <span>ğŸ²</span> ã‚µãƒ³ãƒ—ãƒ«ã§åŸ‹ã‚ã‚‹
      </button>
      <button class="btn-danger" id="btnReset">
        <span>ğŸ—‘ï¸</span> ãƒªã‚»ãƒƒãƒˆ
      </button>
      <button class="theme-toggle" id="themeToggle" title="ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ"></button>
    </div>
  </header>

  <main>
    <div class="grid">
      <!-- LEFT: Settings -->
      <section class="card">
        <div class="card-header">
          <div class="card-title">
            <span class="step">1</span>
            åŸºæœ¬è¨­å®š
          </div>
          <div class="pill" id="presetPill">ã‚µãƒ ãƒã‚¤ãƒ«</div>
        </div>
        <div class="card-body">
          <!-- Quick Presets -->
          <div class="section-header">
            <span>âš¡</span> ã‚¯ã‚¤ãƒƒã‚¯ãƒ—ãƒªã‚»ãƒƒãƒˆ
          </div>
          <div class="preset-grid">
            <button class="preset-btn active" data-preset="thumbnail">ğŸ¬ ã‚µãƒ ãƒ</button>
            <button class="preset-btn" data-preset="diagram">ğŸ“Š å›³è§£</button>
            <button class="preset-btn" data-preset="compare">âš–ï¸ æ¯”è¼ƒ</button>
            <button class="preset-btn" data-preset="steps">ğŸ“ æ‰‹é †</button>
            <button class="preset-btn" data-preset="comic4">ğŸ’¬ 4ã‚³ãƒ</button>
            <button class="preset-btn" data-preset="banner">ğŸ·ï¸ ãƒãƒŠãƒ¼</button>
          </div>

          <div class="divider"></div>

          <div class="section-header">
            <span>ğŸ¯</span> å‡ºåŠ›è¨­å®š
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label><span class="icon">ğŸ¤–</span> å¯¾è±¡ãƒ¢ãƒ‡ãƒ«</label>
              <select id="model">
                <option value="general">æ±ç”¨ï¼ˆã©ã®AIã§ã‚‚ï¼‰</option>
                <option value="dalle3">DALL-E 3</option>
                <option value="midjourney">Midjourney</option>
                <option value="sdxl">Stable Diffusion XL</option>
                <option value="firefly">Adobe Firefly</option>
                <option value="ideogram">Ideogram</option>
              </select>
            </div>
            <div class="form-group">
              <label><span class="icon">ğŸŒ</span> å‡ºåŠ›è¨€èª</label>
              <select id="language">
                <option value="ja">æ—¥æœ¬èª</option>
                <option value="en">English</option>
                <option value="both">ä¸¡æ–¹ï¼ˆä½µè¨˜ï¼‰</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label><span class="icon">ğŸ¨</span> ä½œæˆã™ã‚‹ã‚‚ã®</label>
            <select id="purpose">
              <option value="thumbnail">ã‚µãƒ ãƒã‚¤ãƒ«ï¼ˆYouTube/ãƒ–ãƒ­ã‚°ï¼‰</option>
              <option value="diagram">å›³è§£ï¼ˆ1æšã§è¦ç‚¹ã‚’ä¼ãˆã‚‹ï¼‰</option>
              <option value="compare">æ¯”è¼ƒå›³è§£ï¼ˆA vs Bï¼‰</option>
              <option value="beforeAfter">Before / After</option>
              <option value="steps">ã‚¹ãƒ†ãƒƒãƒ—å›³è§£ï¼ˆæ‰‹é †èª¬æ˜ï¼‰</option>
              <option value="comic4">4ã‚³ãƒæ¼«ç”»</option>
              <option value="banner">ãƒãƒŠãƒ¼åºƒå‘Š</option>
              <option value="icon">ã‚¢ã‚¤ã‚³ãƒ³/ãƒ­ã‚´</option>
              <option value="infographic">ã‚¤ãƒ³ãƒ•ã‚©ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯</option>
            </select>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label><span class="icon">ğŸ“</span> ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”</label>
              <select id="ratio">
                <option value="16:9">16:9ï¼ˆæ¨ªé•·ï¼‰</option>
                <option value="1:1">1:1ï¼ˆæ­£æ–¹å½¢ï¼‰</option>
                <option value="9:16">9:16ï¼ˆç¸¦é•·ï¼‰</option>
                <option value="4:3">4:3</option>
                <option value="3:2">3:2</option>
                <option value="21:9">21:9ï¼ˆã‚¦ãƒ«ãƒˆãƒ©ãƒ¯ã‚¤ãƒ‰ï¼‰</option>
              </select>
            </div>
            <div class="form-group">
              <label><span class="icon">ğŸ“</span> ã‚¿ã‚¤ãƒˆãƒ«ä½ç½®</label>
              <select id="layout">
                <option value="top">ä¸Šéƒ¨</option>
                <option value="center">ä¸­å¤®ï¼ˆç›®ç«‹ãŸã›ã‚‹ï¼‰</option>
                <option value="bottom">ä¸‹éƒ¨</option>
                <option value="left">å·¦å´ï¼ˆç¸¦æ›¸ãå¯ï¼‰</option>
                <option value="right">å³å´</option>
              </select>
            </div>
          </div>

          <div class="divider"></div>

          <div class="section-header">
            <span>ğŸ–¼ï¸</span> ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
          </div>

          <div class="form-group">
            <label><span class="icon">âœ¨</span> ç”»é¢¨</label>
            <select id="style">
              <option value="corporate">ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ãƒˆï¼ˆæ¸…æ½”ãƒ»ä¿¡é ¼æ„Ÿï¼‰</option>
              <option value="flat">ãƒ•ãƒ©ãƒƒãƒˆãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰</option>
              <option value="pict">ãƒ”ã‚¯ãƒˆã‚°ãƒ©ãƒ /ã‚¢ã‚¤ã‚³ãƒ³èª¿</option>
              <option value="isometric">ã‚¢ã‚¤ã‚½ãƒ¡ãƒˆãƒªãƒƒã‚¯</option>
              <option value="cel">ã‚»ãƒ«å¡—ã‚Šã‚¢ãƒ‹ãƒ¡èª¿</option>
              <option value="pastel3d">3Dãƒ‘ã‚¹ãƒ†ãƒ«ï¼ˆã‹ã‚ã„ã„ï¼‰</option>
              <option value="loose">ã‚†ã‚‹ã‹ã‚ã‚¤ãƒ©ã‚¹ãƒˆ</option>
              <option value="hand">æ‰‹æ›¸ãé¢¨</option>
              <option value="photo">ãƒ•ã‚©ãƒˆãƒªã‚¢ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯</option>
              <option value="watercolor">æ°´å½©ç”»é¢¨</option>
              <option value="neon">ãƒã‚ªãƒ³/ã‚µã‚¤ãƒãƒ¼</option>
            </select>
          </div>

          <div class="form-group">
            <label><span class="icon">ğŸ’ª</span> ã‚¹ã‚¿ã‚¤ãƒ«å¼·åº¦</label>
            <div class="range-wrapper">
              <input type="range" id="styleStrength" min="1" max="10" value="7">
              <span class="range-value" id="styleStrengthValue">7</span>
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label><span class="icon">ğŸ­</span> ãƒˆãƒ¼ãƒ³</label>
              <select id="tone">
                <option value="business">ãƒ“ã‚¸ãƒã‚¹ï¼ˆè½ã¡ç€ãï¼‰</option>
                <option value="friendly">ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ï¼ˆè¦ªã—ã¿ï¼‰</option>
                <option value="energetic">ã‚¨ãƒãƒ«ã‚®ãƒƒã‚·ãƒ¥ï¼ˆå…ƒæ°—ï¼‰</option>
                <option value="luxury">ãƒ©ã‚°ã‚¸ãƒ¥ã‚¢ãƒªãƒ¼ï¼ˆé«˜ç´šæ„Ÿï¼‰</option>
                <option value="playful">ãƒãƒƒãƒ—ï¼ˆæ¥½ã—ã„ï¼‰</option>
                <option value="minimal">ãƒŸãƒ‹ãƒãƒ«ï¼ˆæ´—ç·´ï¼‰</option>
              </select>
            </div>
            <div class="form-group">
              <label><span class="icon">ğŸ–¼ï¸</span> èƒŒæ™¯</label>
              <select id="bg">
                <option value="white">ç™½ï¼ˆä½™ç™½é‡è¦–ï¼‰</option>
                <option value="lightGrad">æ·¡ã„ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</option>
                <option value="darkGrad">ãƒ€ãƒ¼ã‚¯ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</option>
                <option value="solid">å˜è‰²</option>
                <option value="photo">å†™çœŸ/é¢¨æ™¯</option>
                <option value="pattern">ãƒ‘ã‚¿ãƒ¼ãƒ³/ãƒ†ã‚¯ã‚¹ãƒãƒ£</option>
                <option value="transparent">é€éï¼ˆPNGç”¨ï¼‰</option>
              </select>
            </div>
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label><span class="icon">ğŸ¨</span> é…è‰²</label>
              <select id="color">
                <option value="brand">ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼å„ªå…ˆ</option>
                <option value="mono">ãƒ¢ãƒãƒˆãƒ¼ãƒ³</option>
                <option value="pastel">ãƒ‘ã‚¹ãƒ†ãƒ«ã‚«ãƒ©ãƒ¼</option>
                <option value="vivid">ãƒ“ãƒ“ãƒƒãƒ‰ã‚«ãƒ©ãƒ¼</option>
                <option value="earth">ã‚¢ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼</option>
                <option value="gradient">ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³</option>
                <option value="duotone">ãƒ‡ãƒ¥ã‚ªãƒˆãƒ¼ãƒ³</option>
              </select>
            </div>
            <div class="form-group">
              <label><span class="icon">ğŸ“</span> æ–‡å­—é‡</label>
              <select id="textAmount">
                <option value="short">å°‘ãªã‚ï¼ˆå¤§ããèª­ã¿ã‚„ã™ãï¼‰</option>
                <option value="mid">ä¸­ç¨‹åº¦</option>
                <option value="more">å¤šã‚ï¼ˆå›³è§£å‘ãï¼‰</option>
                <option value="none">æ–‡å­—ãªã—</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label><span class="icon">âœ¨</span> ä»•ä¸ŠãŒã‚Š</label>
            <select id="quality">
              <option value="clean">ã‚¯ãƒªãƒ¼ãƒ³ï¼ˆãƒã‚¤ã‚ºå°‘ï¼‰</option>
              <option value="rich">ãƒªãƒƒãƒï¼ˆãƒ‡ã‚£ãƒ†ãƒ¼ãƒ«å¤šï¼‰</option>
              <option value="simple">ã‚·ãƒ³ãƒ—ãƒ«ï¼ˆãƒŸãƒ‹ãƒãƒ«ï¼‰</option>
              <option value="detailed">è¶…é«˜ç²¾ç´°</option>
            </select>
          </div>

          <div class="hint">
            ğŸ’¡ è¨­å®šã«è¿·ã£ãŸã‚‰ã€ãƒ—ãƒªã‚»ãƒƒãƒˆã‚’é¸ã‚“ã§ã‹ã‚‰å¾®èª¿æ•´ã™ã‚‹ã®ãŒãŠã™ã™ã‚ã§ã™ã€‚
          </div>
        </div>
      </section>

      <!-- RIGHT: Content Input + Output -->
      <section class="card">
        <div class="card-header">
          <div class="card-title">
            <span class="step">2</span>
            ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å…¥åŠ›
          </div>
          <div class="pill">ğŸ’¾ è‡ªå‹•ä¿å­˜ON</div>
        </div>
        <div class="card-body">
          <div class="section-header">
            <span>ğŸ’¬</span> ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„
          </div>

          <div class="form-group">
            <label><span class="icon">ğŸ“Œ</span> ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆå¤§è¦‹å‡ºã—ï¼‰</label>
            <input id="title" type="text" placeholder="ä¾‹ï¼‰3åˆ†ã§ã‚ã‹ã‚‹GASè‡ªå‹•åŒ– / å¤±æ•—ã—ãªã„ã‚µãƒ¼ãƒãƒ¼æ§‹ç¯‰" />
          </div>

          <div class="form-group">
            <label><span class="icon">ğŸ’­</span> ã‚µãƒ–ã‚³ãƒ”ãƒ¼ï¼ˆä»»æ„ï¼‰</label>
            <input id="subtitle" type="text" placeholder="ä¾‹ï¼‰åˆå¿ƒè€…ã§ã‚‚ä»Šæ—¥ã‹ã‚‰ä½¿ãˆã‚‹ï¼" />
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label><span class="icon">ğŸ‘¥</span> ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ</label>
              <input id="audience" type="text" placeholder="ä¾‹ï¼‰æ–°äººã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ / çµŒå–¶è€…" />
            </div>
            <div class="form-group">
              <label><span class="icon">ğŸ¯</span> ä¸ãˆãŸã„å°è±¡</label>
              <input id="goal" type="text" placeholder="ä¾‹ï¼‰ä¿¡é ¼æ„Ÿ / ç°¡å˜ãã† / å°‚é–€çš„" />
            </div>
          </div>

          <div class="form-group">
            <label><span class="icon">ğŸ“‹</span> ä¼ãˆãŸã„è¦ç‚¹ï¼ˆç®‡æ¡æ›¸ãOKï¼‰</label>
            <textarea id="message" placeholder="ä¾‹ï¼‰
ãƒ»çµè«–ï¼šã¾ãšã“ã‚Œã ã‘ã‚„ã‚Œã°OK
ãƒ»ã‚ˆãã‚ã‚‹å¤±æ•—ãƒ‘ã‚¿ãƒ¼ãƒ³ã¨å¯¾ç­–
ãƒ»ã‚¹ãƒ†ãƒƒãƒ—1â†’2â†’3ã®æµã‚Œ
ãƒ»æœ€å¾Œã«æ³¨æ„ç‚¹ã‚’ã¾ã¨ã‚"></textarea>
          </div>

          <div class="divider"></div>

          <div class="section-header">
            <span>ğŸ¨</span> ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«è¦ç´ 
          </div>

          <div class="form-grid">
            <div class="form-group">
              <label><span class="icon">ğŸ‘¤</span> ç™»å ´äººç‰©/è¦ç´ </label>
              <input id="characters" type="text" placeholder="ä¾‹ï¼‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã€PCã€ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ" />
            </div>
            <div class="form-group">
              <label><span class="icon">ğŸ¨</span> ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼</label>
              <input id="brandColor" type="text" placeholder="ä¾‹ï¼‰#8B5CF6 / ç´«ç³»" />
            </div>
          </div>

          <div class="form-group">
            <label><span class="icon">âš ï¸</span> åˆ¶ç´„ãƒ»NGäº‹é …</label>
            <textarea id="constraints" placeholder="ä¾‹ï¼‰
ãƒ»æ–‡å­—ã¯å¿…ãšèª­ã‚ã‚‹ã‚µã‚¤ã‚ºã§
ãƒ»ä½™ç™½ã‚’ååˆ†ã«ç¢ºä¿
ãƒ»ç‰ˆæ¨©ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã¯ä½¿ç”¨ä¸å¯
ãƒ»æš—ã„è‰²ã¯é¿ã‘ã‚‹"></textarea>
          </div>

          <div class="form-group">
            <label><span class="icon">ğŸš«</span> ãƒã‚¬ãƒ†ã‚£ãƒ–ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆé¿ã‘ãŸã„è¦ç´ ï¼‰</label>
            <input id="negative" type="text" placeholder="ä¾‹ï¼‰ã¼ã‚„ã‘ã€ä½å“è³ªã€æ–‡å­—åŒ–ã‘ã€æ‰‹ã®å¤‰å½¢" />
          </div>

          <div class="divider"></div>

          <!-- Output Section -->
          <div class="section-header">
            <span class="step" style="background: var(--gradient-success);">3</span>
            <span style="margin-left: 4px;">ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ</span>
            <div class="pill" id="modePill" style="margin-left: auto;">æ±ç”¨ãƒ¢ãƒ¼ãƒ‰</div>
          </div>

          <div class="prompt-output" id="promptOut" aria-label="ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ"></div>

          <div class="status-bar">
            <div class="status-item">
              ğŸ“Š æ–‡å­—æ•°: <strong id="charCount">0</strong>
            </div>
            <div class="status-item">
              ğŸ¯ ãƒ¢ãƒ‡ãƒ«: <strong id="modelDisplay">æ±ç”¨</strong>
            </div>
            <div class="status-item" id="warnArea">
              âœ… å…¥åŠ›OK
            </div>
          </div>

          <div class="actions-bar">
            <button class="btn-primary" id="btnCopy">
              <span>ğŸ“‹</span> ã‚³ãƒ”ãƒ¼
            </button>
            <button class="btn-success" id="btnDownload">
              <span>ğŸ’¾</span> .txtã§ä¿å­˜
            </button>
            <button id="btnShorten">
              <span>âœ‚ï¸</span> åœ§ç¸®
            </button>
            <button id="btnAddHistory">
              <span>ğŸ“š</span> å±¥æ­´ã«è¿½åŠ 
            </button>
          </div>

          <!-- History Panel -->
          <div class="history-panel">
            <div class="history-title">
              <span>ğŸ“š</span> æœ€è¿‘ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ
            </div>
            <div class="history-list" id="historyList">
              <div class="history-item" style="color: var(--text-muted); justify-content: center;">
                ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“
              </div>
            </div>
          </div>

          <div class="hint">
            ğŸš€ <strong>ä½¿ã„æ–¹ï¼š</strong>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãã®ã¾ã¾ç”»åƒç”ŸæˆAIã«è²¼ã‚Šä»˜ã‘ã€‚çµæœãŒã‚¤ãƒ¡ãƒ¼ã‚¸ã¨é•ã£ãŸã‚‰ã€Œåˆ¶ç´„ã€ã«è¿½è¨˜ã—ã¦å†ç”Ÿæˆã‚’ç¹°ã‚Šè¿”ã™ã®ãŒè¿‘é“ã§ã™ï¼
          </div>
        </div>
      </section>
    </div>
  </main>

  <footer class="footer">
    <div>
      âŒ¨ï¸ ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: 
      <span class="kbd">Ctrl</span> + <span class="kbd">Enter</span> ã§ã‚³ãƒ”ãƒ¼ / 
      <span class="kbd">Esc</span> ã§è­¦å‘Šã‚¯ãƒªã‚¢
    </div>
    <div>
      Made with âš¡ by PromptForge
    </div>
  </footer>

  <div class="toast" id="toast">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const els = {
    model: $("model"),
    language: $("language"),
    purpose: $("purpose"),
    ratio: $("ratio"),
    layout: $("layout"),
    style: $("style"),
    styleStrength: $("styleStrength"),
    styleStrengthValue: $("styleStrengthValue"),
    tone: $("tone"),
    bg: $("bg"),
    color: $("color"),
    textAmount: $("textAmount"),
    quality: $("quality"),

    title: $("title"),
    subtitle: $("subtitle"),
    audience: $("audience"),
    goal: $("goal"),
    message: $("message"),
    characters: $("characters"),
    brandColor: $("brandColor"),
    constraints: $("constraints"),
    negative: $("negative"),

    presetPill: $("presetPill"),
    modePill: $("modePill"),
    modelDisplay: $("modelDisplay"),
    promptOut: $("promptOut"),
    charCount: $("charCount"),
    warnArea: $("warnArea"),
    toast: $("toast"),
    historyList: $("historyList"),

    btnCopy: $("btnCopy"),
    btnCopyTop: $("btnCopyTop"),
    btnReset: $("btnReset"),
    btnRandom: $("btnRandom"),
    btnDownload: $("btnDownload"),
    btnShorten: $("btnShorten"),
    btnAddHistory: $("btnAddHistory"),
    themeToggle: $("themeToggle"),
  };

  const STORAGE_KEY = "promptforge_data_v1";
  const HISTORY_KEY = "promptforge_history_v1";

  const dict = {
    purpose: {
      thumbnail: "ã‚µãƒ ãƒã‚¤ãƒ«",
      diagram: "å›³è§£",
      compare: "æ¯”è¼ƒå›³è§£",
      beforeAfter: "Before/After",
      steps: "ã‚¹ãƒ†ãƒƒãƒ—å›³è§£",
      comic4: "4ã‚³ãƒæ¼«ç”»",
      banner: "ãƒãƒŠãƒ¼",
      icon: "ã‚¢ã‚¤ã‚³ãƒ³/ãƒ­ã‚´",
      infographic: "ã‚¤ãƒ³ãƒ•ã‚©ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯",
    },
    model: {
      general: "æ±ç”¨",
      dalle3: "DALL-E 3",
      midjourney: "Midjourney",
      sdxl: "Stable Diffusion XL",
      firefly: "Adobe Firefly",
      ideogram: "Ideogram",
    },
    layout: { top:"ä¸Šéƒ¨", center:"ä¸­å¤®", bottom:"ä¸‹éƒ¨", left:"å·¦", right:"å³" },
    tone: { business:"ãƒ“ã‚¸ãƒã‚¹", friendly:"ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼", energetic:"ã‚¨ãƒãƒ«ã‚®ãƒƒã‚·ãƒ¥", luxury:"ãƒ©ã‚°ã‚¸ãƒ¥ã‚¢ãƒªãƒ¼", playful:"ãƒãƒƒãƒ—", minimal:"ãƒŸãƒ‹ãƒãƒ«" },
    bg: { white:"ç™½", lightGrad:"æ·¡ã„ã‚°ãƒ©ãƒ‡", darkGrad:"ãƒ€ãƒ¼ã‚¯ã‚°ãƒ©ãƒ‡", solid:"å˜è‰²", photo:"å†™çœŸ", pattern:"ãƒ‘ã‚¿ãƒ¼ãƒ³", transparent:"é€é" },
    color: { brand:"ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼", mono:"ãƒ¢ãƒãƒˆãƒ¼ãƒ³", pastel:"ãƒ‘ã‚¹ãƒ†ãƒ«", vivid:"ãƒ“ãƒ“ãƒƒãƒ‰", earth:"ã‚¢ãƒ¼ã‚¹", gradient:"ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³", duotone:"ãƒ‡ãƒ¥ã‚ªãƒˆãƒ¼ãƒ³" },
    textAmount: { short:"å°‘ãªã‚", mid:"ä¸­ç¨‹åº¦", more:"å¤šã‚", none:"ãªã—" },
    quality: { clean:"ã‚¯ãƒªãƒ¼ãƒ³", rich:"ãƒªãƒƒãƒ", simple:"ã‚·ãƒ³ãƒ—ãƒ«", detailed:"è¶…é«˜ç²¾ç´°" },
    style: {
      corporate:"ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ãƒˆ",
      flat:"ãƒ•ãƒ©ãƒƒãƒˆãƒ‡ã‚¶ã‚¤ãƒ³",
      pict:"ãƒ”ã‚¯ãƒˆã‚°ãƒ©ãƒ ",
      isometric:"ã‚¢ã‚¤ã‚½ãƒ¡ãƒˆãƒªãƒƒã‚¯",
      cel:"ã‚»ãƒ«å¡—ã‚Šã‚¢ãƒ‹ãƒ¡",
      pastel3d:"3Dãƒ‘ã‚¹ãƒ†ãƒ«",
      loose:"ã‚†ã‚‹ã‹ã‚",
      hand:"æ‰‹æ›¸ãé¢¨",
      photo:"ãƒ•ã‚©ãƒˆãƒªã‚¢ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯",
      watercolor:"æ°´å½©ç”»é¢¨",
      neon:"ãƒã‚ªãƒ³/ã‚µã‚¤ãƒãƒ¼",
    }
  };

  let history = [];

  function toast(msg) {
    els.toast.textContent = msg;
    els.toast.classList.add("show");
    setTimeout(() => els.toast.classList.remove("show"), 1500);
  }

  function save() {
    const data = {};
    const keys = ['model', 'language', 'purpose', 'ratio', 'layout', 'style', 'styleStrength', 'tone', 'bg', 'color', 'textAmount', 'quality', 'title', 'subtitle', 'audience', 'goal', 'message', 'characters', 'brandColor', 'constraints', 'negative'];
    keys.forEach(k => {
      if (els[k] && ("value" in els[k])) data[k] = els[k].value;
    });
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  function load() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return;
    try {
      const data = JSON.parse(raw);
      for (const [k, v] of Object.entries(data)) {
        if (els[k] && ("value" in els[k])) els[k].value = v;
      }
      if (data.styleStrength) {
        els.styleStrengthValue.textContent = data.styleStrength;
      }
    } catch(e) {}
  }

  function loadHistory() {
    const raw = localStorage.getItem(HISTORY_KEY);
    if (raw) {
      try {
        history = JSON.parse(raw);
        renderHistory();
      } catch(e) {}
    }
  }

  function saveHistory() {
    localStorage.setItem(HISTORY_KEY, JSON.stringify(history.slice(0, 10)));
  }

  function renderHistory() {
    if (history.length === 0) {
      els.historyList.innerHTML = '<div class="history-item" style="color: var(--text-muted); justify-content: center;">ã¾ã å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</div>';
      return;
    }
    els.historyList.innerHTML = history.map((item, i) => `
      <div class="history-item" data-index="${i}">
        <span class="history-item-title">${item.title || 'ç„¡é¡Œ'}</span>
        <span class="history-item-meta">${item.purpose} â€¢ ${item.date}</span>
      </div>
    `).join('');

    els.historyList.querySelectorAll('.history-item').forEach(el => {
      el.addEventListener('click', () => {
        const idx = parseInt(el.dataset.index);
        loadFromHistory(idx);
      });
    });
  }

  function loadFromHistory(idx) {
    const item = history[idx];
    if (!item) return;
    Object.keys(item.data || {}).forEach(k => {
      if (els[k] && ("value" in els[k])) els[k].value = item.data[k];
    });
    if (item.data.styleStrength) {
      els.styleStrengthValue.textContent = item.data.styleStrength;
    }
    buildPrompt();
    toast("å±¥æ­´ã‹ã‚‰èª­ã¿è¾¼ã¿ã¾ã—ãŸ");
  }

  function addToHistory() {
    const data = {};
    const keys = ['model', 'language', 'purpose', 'ratio', 'layout', 'style', 'styleStrength', 'tone', 'bg', 'color', 'textAmount', 'quality', 'title', 'subtitle', 'audience', 'goal', 'message', 'characters', 'brandColor', 'constraints', 'negative'];
    keys.forEach(k => {
      if (els[k] && ("value" in els[k])) data[k] = els[k].value;
    });

    const now = new Date();
    const dateStr = `${now.getMonth()+1}/${now.getDate()} ${now.getHours()}:${String(now.getMinutes()).padStart(2,'0')}`;
    
    history.unshift({
      title: els.title.value.trim() || 'ç„¡é¡Œ',
      purpose: dict.purpose[els.purpose.value] || els.purpose.value,
      date: dateStr,
      data: data
    });

    if (history.length > 10) history = history.slice(0, 10);
    saveHistory();
    renderHistory();
    toast("å±¥æ­´ã«è¿½åŠ ã—ã¾ã—ãŸ");
  }

  function recommendWarnings() {
    const t = els.title.value.trim();
    const m = els.message.value.trim();
    const p = els.purpose.value;

    let warns = [];
    if (!t) warns.push("ã‚¿ã‚¤ãƒˆãƒ«æœªå…¥åŠ›");
    if (!m) warns.push("è¦ç‚¹æœªå…¥åŠ›");
    if (p === "comic4" && !els.characters.value.trim()) warns.push("4ã‚³ãƒã¯ç™»å ´äººç‰©æ¨å¥¨");
    if ((p === "compare" || p === "beforeAfter") && m.split("\n").filter(Boolean).length < 2) warns.push("æ¯”è¼ƒç³»ã¯2é …ç›®ä»¥ä¸Šæ¨å¥¨");

    if (warns.length) {
      els.warnArea.innerHTML = `âš ï¸ ${warns.join(" / ")}`;
      els.warnArea.classList.add("status-warn");
      els.warnArea.classList.remove("status-ok");
    } else {
      els.warnArea.textContent = "âœ… å…¥åŠ›OK";
      els.warnArea.classList.add("status-ok");
      els.warnArea.classList.remove("status-warn");
    }
  }

  function buildPrompt() {
    const model = els.model.value;
    const language = els.language.value;
    const purpose = els.purpose.value;
    const ratio = els.ratio.value;
    const layout = els.layout.value;
    const style = els.style.value;
    const styleStrength = els.styleStrength.value;
    const tone = els.tone.value;
    const bg = els.bg.value;
    const color = els.color.value;
    const textAmount = els.textAmount.value;
    const quality = els.quality.value;

    const title = els.title.value.trim();
    const subtitle = els.subtitle.value.trim();
    const audience = els.audience.value.trim();
    const goal = els.goal.value.trim();
    const message = els.message.value.trim();
    const characters = els.characters.value.trim();
    const brandColor = els.brandColor.value.trim();
    const constraints = els.constraints.value.trim();
    const negative = els.negative.value.trim();

    els.presetPill.textContent = dict.purpose[purpose] || purpose;
    els.modePill.textContent = `${dict.model[model]} â€¢ ${dict.style[style]}`;
    els.modelDisplay.textContent = dict.model[model] || model;

    const purposeGuideJa = {
      thumbnail: "è¦–èªæ€§æœ€å„ªå…ˆã€‚ã‚¿ã‚¤ãƒˆãƒ«ã¯å¤§ããã€è¦ç´ ã¯å°‘ãªãã€å¼·ã„ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã€‚é‡è¦ãƒ¯ãƒ¼ãƒ‰ã¯2ã€œ5èªã«çµã‚‹ã€‚",
      diagram: "æƒ…å ±ã‚’éšå±¤åŒ–ï¼ˆè¦‹å‡ºã—â†’è¦ç‚¹â†’è£œè¶³ï¼‰ã€‚ã‚¢ã‚¤ã‚³ãƒ³/å›³å½¢/çŸ¢å°ã§ç†è§£ã‚’è£œåŠ©ã€‚",
      compare: "A/Bã‚’å·¦å³ã¾ãŸã¯ä¸Šä¸‹ã§å¯¾æ¯”ã€‚å·®åˆ†ãŒä¸€ç›®ã§ã‚ã‹ã‚‹æ§‹æˆã€‚æ¯”è¼ƒè»¸ã¯2ã€œ4å€‹ã€‚",
      beforeAfter: "Beforeã¨Afterã‚’æ˜ç¢ºã«åˆ†é›¢ã—ã€å¤‰åŒ–ç‚¹ã‚’å¼·èª¿ã€‚çŸ¢å°ã‚„ãƒã‚¤ãƒ©ã‚¤ãƒˆã§æ”¹å–„ã‚’å¯è¦–åŒ–ã€‚",
      steps: "1â†’2â†’3ã®æµã‚Œã‚’ç•ªå·ãƒ»çŸ¢å°ã§èª˜å°ã€‚å„ã‚¹ãƒ†ãƒƒãƒ—ã¯çŸ­æ–‡ï¼‹ã‚¢ã‚¤ã‚³ãƒ³ã€‚",
      comic4: "4ã‚³ãƒæ§‹æˆï¼ˆèµ·æ‰¿è»¢çµï¼‰ã€‚ã‚»ãƒªãƒ•ã¯çŸ­ãã€è¡¨æƒ…ã§æ„Ÿæƒ…ã‚’ä¼ãˆã‚‹ã€‚",
      banner: "æ¨ªé•·æƒ³å®šã€‚ä½™ç™½ãƒ»è¦–èªæ€§ãƒ»CTAã‚’æ„è­˜ã€‚ä¸»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸1æœ¬ï¼‹è£œåŠ©1æœ¬ã¾ã§ã€‚",
      icon: "ã‚·ãƒ³ãƒ—ãƒ«ã§èªè­˜ã—ã‚„ã™ã„å½¢çŠ¶ã€‚ç´°éƒ¨ã‚ˆã‚Šå…¨ä½“ã®ã‚·ãƒ«ã‚¨ãƒƒãƒˆé‡è¦–ã€‚",
      infographic: "ãƒ‡ãƒ¼ã‚¿ã‚„æƒ…å ±ã‚’è¦–è¦šçš„ã«æ•´ç†ã€‚ã‚°ãƒ©ãƒ•/ãƒãƒ£ãƒ¼ãƒˆ/ã‚¢ã‚¤ã‚³ãƒ³ã‚’åŠ¹æœçš„ã«é…ç½®ã€‚",
    };

    const purposeGuideEn = {
      thumbnail: "Prioritize visibility. Large title, minimal elements, strong contrast. Key words limited to 2-5.",
      diagram: "Hierarchical information (headlineâ†’pointsâ†’details). Use icons/shapes/arrows for clarity.",
      compare: "A/B comparison side-by-side or top-bottom. Clear differentiation with 2-4 comparison axes.",
      beforeAfter: "Clear separation of Before/After with emphasis on changes. Arrows/highlights to show improvement.",
      steps: "Guide flow with numbers/arrows (1â†’2â†’3). Each step: short text + icon.",
      comic4: "4-panel structure (setupâ†’developmentâ†’twistâ†’conclusion). Short dialogue, expressive faces.",
      banner: "Horizontal layout. Focus on whitespace, visibility, CTA. One main message + one supporting.",
      icon: "Simple, recognizable shapes. Overall silhouette over fine details.",
      infographic: "Visually organize data/information. Effective use of graphs/charts/icons.",
    };

    const layoutJa = {
      top: "ã‚¿ã‚¤ãƒˆãƒ«ã¯ä¸Šéƒ¨ã«é…ç½®",
      center: "ã‚¿ã‚¤ãƒˆãƒ«ã¯ä¸­å¤®ã«å¤§ããé…ç½®ï¼ˆæœ€å„ªå…ˆã§ç›®ç«‹ãŸã›ã‚‹ï¼‰",
      bottom: "ã‚¿ã‚¤ãƒˆãƒ«ã¯ä¸‹éƒ¨ã«é…ç½®ï¼ˆä¸»å½¹ã®é‚ªé­”ã‚’ã—ãªã„ï¼‰",
      left: "ã‚¿ã‚¤ãƒˆãƒ«ã¯å·¦å´ã«é…ç½®ï¼ˆç¸¦æ›¸ãã‚‚å¯ï¼‰",
      right: "ã‚¿ã‚¤ãƒˆãƒ«ã¯å³å´ã«é…ç½®"
    };

    const layoutEn = {
      top: "Title at top",
      center: "Title centered and prominent",
      bottom: "Title at bottom",
      left: "Title on left side",
      right: "Title on right side"
    };

    const coreBlockJa = [
      title ? `ã€ã‚¿ã‚¤ãƒˆãƒ«ã€‘${title}` : "ã€ã‚¿ã‚¤ãƒˆãƒ«ã€‘ï¼ˆçŸ­ãå¼·ã„ãƒ•ãƒ¬ãƒ¼ã‚ºã§ï¼‰",
      subtitle ? `ã€ã‚µãƒ–ã‚³ãƒ”ãƒ¼ã€‘${subtitle}` : null,
      audience ? `ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã€‘${audience}` : null,
      goal ? `ã€ä¸ãˆãŸã„å°è±¡ã€‘${goal}` : null,
      characters ? `ã€ç™»å ´è¦ç´ ã€‘${characters}` : null,
      message ? `ã€è¦ç‚¹ã€‘\n${message}` : "ã€è¦ç‚¹ã€‘ï¼ˆç®‡æ¡æ›¸ãã§è¨˜å…¥æ¨å¥¨ï¼‰",
      constraints ? `ã€åˆ¶ç´„/NGã€‘\n${constraints}` : null,
      negative ? `ã€é¿ã‘ãŸã„è¦ç´ ã€‘${negative}` : null
    ].filter(Boolean).join("\n\n");

    const coreBlockEn = [
      title ? `[Title] ${title}` : "[Title] (Strong, concise phrase)",
      subtitle ? `[Subtitle] ${subtitle}` : null,
      audience ? `[Target Audience] ${audience}` : null,
      goal ? `[Desired Impression] ${goal}` : null,
      characters ? `[Visual Elements] ${characters}` : null,
      message ? `[Key Points]\n${message}` : "[Key Points] (Bullet points recommended)",
      constraints ? `[Constraints]\n${constraints}` : null,
      negative ? `[Negative Prompt] ${negative}` : null
    ].filter(Boolean).join("\n\n");

    let prompt = "";

    if (language === "ja" || language === "both") {
      prompt += `ã‚ãªãŸã¯ä¸€æµã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼ã§ã™ã€‚
ä»¥ä¸‹ã®è¦ä»¶ã‚’æº€ãŸã™ã€Œ${dict.purpose[purpose]}ã€ã®ç”»åƒã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

ã€ä»•æ§˜ã€‘
- ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”: ${ratio}
- ç”»é¢¨: ${dict.style[style]}ï¼ˆå¼·åº¦: ${styleStrength}/10ï¼‰
- ${layoutJa[layout]}
- èƒŒæ™¯: ${dict.bg[bg]} / ãƒˆãƒ¼ãƒ³: ${dict.tone[tone]}
- é…è‰²: ${dict.color[color]}${brandColor ? ` / ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼: ${brandColor}` : ''}
- æ–‡å­—é‡: ${dict.textAmount[textAmount]} / ä»•ä¸ŠãŒã‚Š: ${dict.quality[quality]}

ã€ãƒ‡ã‚¶ã‚¤ãƒ³æ–¹é‡ã€‘
${purposeGuideJa[purpose] || ''}
- æ–‡å­—ã¯ã€Œèª­ã¿ã‚„ã™ã•ã€æœ€å„ªå…ˆã€‚é‡è¦èªã¯å¤ªãå¤§ããã€‚
- ä½™ç™½ã‚’ç¢ºä¿ã—ã€è¦ç´ ã‚’è©°ã‚è¾¼ã¿ã™ããªã„ã€‚
- è¦–ç·šèª˜å°ï¼ˆçŸ¢å°/æ /ç•ªå·/å¼·èª¿ï¼‰ã‚’æ„è­˜ã€‚
- æ—¥æœ¬èªãƒ†ã‚­ã‚¹ãƒˆã¯è‡ªç„¶ã§èª¤å­—ãªãã€‚

ã€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã€‘
${coreBlockJa}

ã€ç”Ÿæˆã®ã‚³ãƒ„ã€‘
- ä¸è¶³æƒ…å ±ã¯æ–‡è„ˆã‹ã‚‰è‡ªç„¶ã«è£œå®ŒOKã€‚
- ä¸»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒãƒ–ãƒ¬ãªã„ã‚ˆã†ã«ã€‚`;
    }

    if (language === "both") {
      prompt += "\n\n---\n\n";
    }

    if (language === "en" || language === "both") {
      prompt += `You are a world-class visual designer.
Create a "${dict.purpose[purpose]}" image meeting these requirements:

[Specifications]
- Aspect Ratio: ${ratio}
- Style: ${dict.style[style]} (Intensity: ${styleStrength}/10)
- ${layoutEn[layout]}
- Background: ${dict.bg[bg]} / Tone: ${dict.tone[tone]}
- Color Scheme: ${dict.color[color]}${brandColor ? ` / Brand Color: ${brandColor}` : ''}
- Text Amount: ${dict.textAmount[textAmount]} / Quality: ${dict.quality[quality]}

[Design Guidelines]
${purposeGuideEn[purpose] || ''}
- Prioritize text readability. Important words bold and large.
- Maintain whitespace, avoid clutter.
- Use visual hierarchy (arrows/frames/numbers/emphasis).
- Natural text without errors.

[Content]
${coreBlockEn}

[Tips]
- Fill in missing info naturally from context.
- Keep the main message focused.`;
    }

    // Model-specific additions
    if (model === "midjourney") {
      prompt += `\n\n--ar ${ratio.replace(':', ':')} --v 6`;
      if (negative) prompt += ` --no ${negative}`;
    } else if (model === "sdxl" && negative) {
      prompt += `\n\nNegative prompt: ${negative}, low quality, blurry, deformed`;
    }

    els.promptOut.textContent = prompt;
    els.charCount.textContent = String(prompt.length);
    recommendWarnings();
  }

  async function copyPrompt() {
    const text = els.promptOut.textContent || "";
    try {
      await navigator.clipboard.writeText(text);
      toast("ğŸ“‹ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
    } catch(e) {
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
      toast("ğŸ“‹ ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
    }
  }

  function downloadTxt() {
    const text = els.promptOut.textContent || "";
    const blob = new Blob([text], {type: "text/plain;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `promptforge_${Date.now()}.txt`;
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
    toast("ğŸ’¾ ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¾ã—ãŸ");
  }

  function resetAll() {
    localStorage.removeItem(STORAGE_KEY);
    
    els.model.value = "general";
    els.language.value = "ja";
    els.purpose.value = "thumbnail";
    els.ratio.value = "16:9";
    els.layout.value = "center";
    els.style.value = "corporate";
    els.styleStrength.value = "7";
    els.styleStrengthValue.textContent = "7";
    els.tone.value = "business";
    els.bg.value = "white";
    els.color.value = "brand";
    els.textAmount.value = "short";
    els.quality.value = "clean";

    els.title.value = "";
    els.subtitle.value = "";
    els.audience.value = "";
    els.goal.value = "";
    els.message.value = "";
    els.characters.value = "";
    els.brandColor.value = "";
    els.constraints.value = "";
    els.negative.value = "";

    updatePresetButtons();
    buildPrompt();
    toast("ğŸ—‘ï¸ ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ");
  }

  function randomFill() {
    const samples = [
      {
        title: "3åˆ†ã§ã‚ã‹ã‚‹GASè‡ªå‹•åŒ–",
        subtitle: "åˆå¿ƒè€…ã§ã‚‚ä»Šæ—¥ã‹ã‚‰ä½¿ãˆã‚‹ï¼",
        audience: "ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°åˆå¿ƒè€…ã€æ¥­å‹™åŠ¹ç‡åŒ–ã—ãŸã„äºº",
        goal: "ç°¡å˜ãã†ã€ã™ãã§ããã†ã€ä¿¡é ¼æ„Ÿ",
        message: "ãƒ»çµè«–ï¼šãƒ†ãƒ³ãƒ—ãƒ¬ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹ã ã‘\nãƒ»ã‚ˆãã‚ã‚‹ã¤ã¾ãšããƒã‚¤ãƒ³ãƒˆ3é¸\nãƒ»å®Ÿè·µã‚¹ãƒ†ãƒƒãƒ— 1â†’2â†’3\nãƒ»æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³",
        characters: "ãƒãƒ¼ãƒˆPCã€ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã€æ­¯è»Šã‚¢ã‚¤ã‚³ãƒ³ã€ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯",
        constraints: "ãƒ»æ–‡å­—ã¯å¤§ããèª­ã¿ã‚„ã™ã\nãƒ»ä½™ç™½å¤šã‚\nãƒ»æ˜ã‚‹ã„é›°å›²æ°—ã§",
        negative: "æš—ã„è‰²ã€è¤‡é›‘ãªèƒŒæ™¯ã€å°ã•ã„æ–‡å­—"
      },
      {
        title: "æ–°äººã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®æ•™ç§‘æ›¸",
        subtitle: "ç¾å ´ã§è©°ã¾ã‚‰ãªã„ãŸã‚ã®åŸºç¤çŸ¥è­˜",
        audience: "æ–°äºº/è‹¥æ‰‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢",
        goal: "è¦ªã—ã¿ã‚„ã™ã„ã€å®‰å¿ƒã€å®Ÿç”¨çš„",
        message: "ãƒ»å®‰å…¨ç¢ºèªï¼ˆæ„Ÿé›»/è»¢å€’é˜²æ­¢ï¼‰\nãƒ»ç¢ºèªæ‰‹é †ï¼ˆé›»æºâ†’é…ç·šâ†’ãƒ­ã‚°ï¼‰\nãƒ»å ±å‘Šã®å‹ï¼ˆçµè«–â†’çŠ¶æ³â†’å¯¾å¿œï¼‰\nãƒ»ãƒˆãƒ©ãƒ–ãƒ«æ™‚ã®ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³",
        characters: "ä½œæ¥­å“¡ã€å·¥å…·ã€ã‚µãƒ¼ãƒãƒ¼ãƒ©ãƒƒã‚¯ã€ãƒãƒ‹ãƒ¥ã‚¢ãƒ«",
        constraints: "ãƒ»è¦ªã—ã¿ã‚„ã™ã„ã‚¤ãƒ©ã‚¹ãƒˆã§\nãƒ»é‡è¦ãƒ¯ãƒ¼ãƒ‰ã¯è‰²ã§å¼·èª¿\nãƒ»ä½™ç™½ç¢ºä¿",
        negative: "æš—ã„é›°å›²æ°—ã€å¨åœ§çš„ã€è¤‡é›‘ã™ãã‚‹"
      },
      {
        title: "Before / After ã§è¦‹ã‚‹æ¥­å‹™æ”¹å–„",
        subtitle: "å¯è¦–åŒ–ã§ç´å¾—æ„Ÿ200%",
        audience: "ç®¡ç†è·ã€ç¾å ´ãƒªãƒ¼ãƒ€ãƒ¼",
        goal: "èª¬å¾—åŠ›ã€ãƒ‡ãƒ¼ã‚¿ãƒ‰ãƒªãƒ–ãƒ³ã€æ”¹å–„åŠ¹æœ",
        message: "Beforeï¼šå±äººçš„ã€æ‰‹ä½œæ¥­ã€ãƒŸã‚¹å¤šç™º\nAfterï¼šè‡ªå‹•åŒ–ã€å¯è¦–åŒ–ã€ãƒŸã‚¹ã‚¼ãƒ­\nåŠ¹æœï¼šå·¥æ•°50%å‰Šæ¸›",
        characters: "å›°ã‚Šé¡”ã®äººã€ç¬‘é¡”ã®äººã€çŸ¢å°ã€ã‚°ãƒ©ãƒ•",
        constraints: "ãƒ»æ¯”è¼ƒãŒä¸€ç›®ã§ã‚ã‹ã‚‹ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ\nãƒ»æ•°å­—ã§åŠ¹æœã‚’ç¤ºã™\nãƒ»ãƒ“ã‚¸ãƒã‚¹æ„Ÿ",
        negative: "ã‚«ã‚¸ãƒ¥ã‚¢ãƒ«ã™ãã‚‹ã€æ´¾æ‰‹ã™ãã‚‹"
      }
    ];

    const s = samples[Math.floor(Math.random() * samples.length)];
    els.title.value = s.title;
    els.subtitle.value = s.subtitle;
    els.audience.value = s.audience;
    els.goal.value = s.goal;
    els.message.value = s.message;
    els.characters.value = s.characters;
    els.constraints.value = s.constraints;
    els.negative.value = s.negative;

    const styles = Object.keys(dict.style);
    els.style.value = styles[Math.floor(Math.random() * styles.length)];
    
    const purposes = Object.keys(dict.purpose);
    const randomPurpose = purposes[Math.floor(Math.random() * purposes.length)];
    els.purpose.value = randomPurpose;

    if (randomPurpose === "banner") els.ratio.value = "21:9";
    else if (randomPurpose === "comic4" || randomPurpose === "icon") els.ratio.value = "1:1";
    else if (randomPurpose === "steps" || randomPurpose === "infographic") els.ratio.value = "9:16";
    else els.ratio.value = "16:9";

    updatePresetButtons();
    buildPrompt();
    toast("ğŸ² ã‚µãƒ³ãƒ—ãƒ«ã§åŸ‹ã‚ã¾ã—ãŸ");
  }

  function shortenVibe() {
    const compress = (txt) => {
      const lines = txt.split("\n").map(l => l.trim()).filter(Boolean);
      return lines.slice(0, 4).map(l => l.length > 35 ? l.slice(0, 35) + "â€¦" : l).join("\n");
    };

    if (els.message.value.trim()) els.message.value = compress(els.message.value);
    if (els.constraints.value.trim()) els.constraints.value = compress(els.constraints.value);
    buildPrompt();
    toast("âœ‚ï¸ åœ§ç¸®ã—ã¾ã—ãŸ");
  }

  function toggleTheme() {
    document.body.classList.toggle("dark-mode");
    localStorage.setItem("promptforge_theme", document.body.classList.contains("dark-mode") ? "dark" : "light");
  }

  function loadTheme() {
    const theme = localStorage.getItem("promptforge_theme");
    if (theme === "dark") {
      document.body.classList.add("dark-mode");
    }
  }

  function updatePresetButtons() {
    document.querySelectorAll('.preset-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.preset === els.purpose.value);
    });
  }

  // Event Listeners
  const allInputs = [
    els.model, els.language, els.purpose, els.ratio, els.layout, els.style, 
    els.styleStrength, els.tone, els.bg, els.color, els.textAmount, els.quality,
    els.title, els.subtitle, els.audience, els.goal, els.message, 
    els.characters, els.brandColor, els.constraints, els.negative
  ];

  allInputs.forEach(el => {
    if (el) {
      el.addEventListener("input", () => { save(); buildPrompt(); });
      el.addEventListener("change", () => { save(); buildPrompt(); updatePresetButtons(); });
    }
  });

  els.styleStrength.addEventListener("input", () => {
    els.styleStrengthValue.textContent = els.styleStrength.value;
  });

  els.btnCopy.addEventListener("click", copyPrompt);
  els.btnCopyTop.addEventListener("click", copyPrompt);
  els.btnDownload.addEventListener("click", downloadTxt);
  els.btnReset.addEventListener("click", resetAll);
  els.btnRandom.addEventListener("click", randomFill);
  els.btnShorten.addEventListener("click", shortenVibe);
  els.btnAddHistory.addEventListener("click", addToHistory);
  els.themeToggle.addEventListener("click", toggleTheme);

  // Preset buttons
  document.querySelectorAll('.preset-btn').forEach(btn => {
    btn.addEventListener('click', () => {
      els.purpose.value = btn.dataset.preset;
      
      // Auto-adjust ratio based on purpose
      const ratioMap = {
        thumbnail: "16:9",
        diagram: "16:9",
        compare: "16:9",
        beforeAfter: "16:9",
        steps: "9:16",
        comic4: "1:1",
        banner: "21:9",
        icon: "1:1",
        infographic: "9:16"
      };
      els.ratio.value = ratioMap[btn.dataset.preset] || "16:9";
      
      updatePresetButtons();
      save();
      buildPrompt();
    });
  });

  // Keyboard shortcuts
  window.addEventListener("keydown", (e) => {
    if ((e.ctrlKey || e.metaKey) && e.key === "Enter") {
      e.preventDefault();
      copyPrompt();
    }
    if (e.key === "Escape") {
      els.warnArea.textContent = "";
      toast("è¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ");
    }
  });

  // Initialize
  loadTheme();
  load();
  loadHistory();
  updatePresetButtons();
  buildPrompt();
})();
</script>
</body>
</html>
