<!doctype html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ãƒŠãƒãƒãƒŠãƒŠã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆé›°å›²æ°—ç‰ˆï¼‰</title>
  <style>
    :root{
      --bg:#0b1020;
      --card:#121a33;
      --card2:#0f1630;
      --text:#e8ecff;
      --muted:#aab3d6;
      --line:rgba(255,255,255,.12);
      --accent:#7c5cff;
      --accent2:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --shadow: 0 18px 50px rgba(0,0,0,.35);
      --radius: 18px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans JP", "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:var(--sans);
      background:
        radial-gradient(1200px 700px at 10% 10%, rgba(124,92,255,.25), transparent 55%),
        radial-gradient(1000px 600px at 90% 20%, rgba(34,197,94,.18), transparent 60%),
        radial-gradient(900px 500px at 50% 95%, rgba(245,158,11,.12), transparent 65%),
        var(--bg);
      color:var(--text);
    }
    header{
      padding:28px 18px 12px;
      max-width:1200px;
      margin:0 auto;
      display:flex;
      gap:14px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
    }
    .brand{
      display:flex; gap:12px; align-items:center;
    }
    .logo{
      width:46px; height:46px; border-radius:14px;
      background:
        linear-gradient(135deg, rgba(124,92,255,.95), rgba(34,197,94,.85));
      box-shadow: var(--shadow);
      display:grid; place-items:center;
      font-size:24px;
    }
    h1{ margin:0; font-size:20px; letter-spacing:.02em;}
    .sub{ margin:4px 0 0; color:var(--muted); font-size:13px; line-height:1.45;}
    .top-actions{ display:flex; gap:10px; flex-wrap:wrap; }
    button, .btn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      transition:.15s transform, .15s background, .15s border;
      font-weight:600;
      letter-spacing:.01em;
    }
    button:hover{ transform:translateY(-1px); background:rgba(255,255,255,.10); }
    button:active{ transform:translateY(0px); }
    .btn-accent{
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(124,92,255,.55));
      border-color: rgba(124,92,255,.65);
    }
    .btn-accent:hover{ background: linear-gradient(135deg, rgba(124,92,255,1), rgba(124,92,255,.65)); }
    .btn-green{
      background: linear-gradient(135deg, rgba(34,197,94,.95), rgba(34,197,94,.55));
      border-color: rgba(34,197,94,.65);
    }
    .btn-danger{
      background: linear-gradient(135deg, rgba(239,68,68,.95), rgba(239,68,68,.55));
      border-color: rgba(239,68,68,.65);
    }

    main{
      max-width:1200px;
      margin:0 auto;
      padding: 8px 18px 28px;
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
    }
    @media (max-width: 980px){
      .grid{ grid-template-columns: 1fr; }
    }
    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .card .hd{
      padding:14px 14px 10px;
      border-bottom:1px solid var(--line);
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
    }
    .card .hd .ttl{
      font-weight:800;
      letter-spacing:.02em;
      display:flex; align-items:center; gap:8px;
    }
    .pill{
      font-size:12px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      color:var(--muted);
      background:rgba(0,0,0,.15);
      white-space:nowrap;
    }
    .card .bd{ padding:14px; }

    .row{
      display:grid;
      grid-template-columns: 160px 1fr;
      gap:10px;
      align-items:center;
      margin-bottom:10px;
    }
    @media (max-width: 560px){
      .row{ grid-template-columns: 1fr; }
    }
    label{
      color:var(--muted);
      font-size:13px;
      line-height:1.2;
    }
    select, input[type="text"], textarea{
      width:100%;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,.20);
      color: var(--text);
      padding: 10px 12px;
      outline: none;
      transition: .15s border, .15s background;
    }
    textarea{ min-height: 90px; resize: vertical; }
    select:focus, input:focus, textarea:focus{
      border-color: rgba(124,92,255,.7);
      background: rgba(0,0,0,.28);
    }
    .two{
      display:grid; grid-template-columns: 1fr 1fr; gap:10px;
    }
    @media (max-width: 560px){ .two{ grid-template-columns: 1fr; } }

    .hint{
      margin-top:6px;
      color:var(--muted);
      font-size:12px;
      line-height:1.55;
    }
    .divider{
      margin:12px 0;
      height:1px;
      background: var(--line);
    }
    .prompt{
      font-family: var(--mono);
      font-size: 12.8px;
      line-height: 1.65;
      white-space: pre-wrap;
      word-break: break-word;
      background: rgba(0,0,0,.22);
      border: 1px solid var(--line);
      border-radius: 14px;
      padding: 12px;
      min-height: 280px;
    }
    .mini-actions{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .status{
      color:var(--muted);
      font-size:12px;
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center;
    }
    .toast{
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 18px;
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid var(--line);
      background: rgba(0,0,0,.55);
      box-shadow: var(--shadow);
      opacity: 0;
      pointer-events:none;
      transition: .18s opacity, .18s transform;
      color: var(--text);
      font-weight:700;
    }
    .toast.show{
      opacity: 1;
      transform: translateX(-50%) translateY(-2px);
    }
    .tag{
      display:inline-block;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid var(--line);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      font-size: 12px;
      margin: 0 6px 6px 0;
    }
    .footer{
      max-width:1200px;
      margin: 14px auto 0;
      padding: 0 18px 22px;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.6;
    }
    .kbd{
      font-family: var(--mono);
      border: 1px solid var(--line);
      padding: 2px 6px;
      border-radius: 8px;
      background: rgba(0,0,0,.22);
      color: var(--text);
      font-size: 11px;
    }
  </style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo" aria-hidden="true">ğŸŒ</div>
      <div>
        <h1>ãƒŠãƒãƒãƒŠãƒŠã‚¸ã‚§ãƒãƒ¬ãƒ¼ã‚¿ãƒ¼ï¼ˆé›°å›²æ°—ç‰ˆï¼‰</h1>
        <p class="sub">
          ã½ã¡ã½ã¡é¸ã‚“ã§ â†’ æ—¥æœ¬èªã§ã‚³ã‚¢ã‚’æ›¸ã„ã¦ â†’ ã§ããŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒšã€‚<br/>
          å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãªã— / ã‚ªãƒ•ãƒ©ã‚¤ãƒ³OK / å…¥åŠ›ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«è‡ªå‹•ä¿å­˜ã€‚
        </p>
      </div>
    </div>

    <div class="top-actions">
      <button class="btn-accent" id="btnCopyTop">ğŸ“‹ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
      <button id="btnRandom">ğŸ² ãã‚Œã£ã½ãåŸ‹ã‚ã‚‹</button>
      <button class="btn-danger" id="btnReset">ğŸ§¹ ãƒªã‚»ãƒƒãƒˆ</button>
    </div>
  </header>

  <main>
    <div class="grid">
      <!-- LEFT: Settings -->
      <section class="card">
        <div class="hd">
          <div class="ttl">ğŸ§© â‘  ã½ã¡ã½ã¡è¨­å®š</div>
          <div class="pill" id="presetPill">Preset: ã‚µãƒ ãƒ</div>
        </div>
        <div class="bd">
          <div class="row">
            <label for="purpose">ä½œã‚‹ã‚‚ã®</label>
            <select id="purpose">
              <option value="thumbnail">ã‚µãƒ ãƒï¼ˆYouTube/ãƒ–ãƒ­ã‚°ï¼‰</option>
              <option value="diagram">å›³è§£ï¼ˆ1æšã§è¦ç‚¹ï¼‰</option>
              <option value="compare">æ¯”è¼ƒå›³è§£ï¼ˆA/Bï¼‰</option>
              <option value="beforeAfter">Before / After</option>
              <option value="steps">ã‚¹ãƒ†ãƒƒãƒ—ï¼ˆ1â†’2â†’3â€¦ï¼‰</option>
              <option value="comic4">4ã‚³ãƒæ¼«ç”»</option>
              <option value="banner">ãƒãƒŠãƒ¼</option>
            </select>
          </div>

          <div class="two">
            <div class="row" style="margin-bottom:0;">
              <label for="ratio">æ¯”ç‡</label>
              <select id="ratio">
                <option value="16:9">16:9ï¼ˆæ¨ªï¼‰</option>
                <option value="1:1">1:1ï¼ˆã‚¹ã‚¯ã‚¨ã‚¢ï¼‰</option>
                <option value="9:16">9:16ï¼ˆç¸¦ï¼‰</option>
                <option value="4:3">4:3</option>
                <option value="3:2">3:2</option>
                <option value="21:9">21:9ï¼ˆã‚¦ãƒ«ãƒˆãƒ©ãƒ¯ã‚¤ãƒ‰ï¼‰</option>
              </select>
            </div>
            <div class="row" style="margin-bottom:0;">
              <label for="layout">ã‚¿ã‚¤ãƒˆãƒ«ä½ç½®</label>
              <select id="layout">
                <option value="top">ä¸Š</option>
                <option value="center">ä¸­å¤®</option>
                <option value="bottom">ä¸‹</option>
                <option value="left">å·¦ï¼ˆç¸¦çµ„ã¿ã‚‚å¯ï¼‰</option>
                <option value="right">å³</option>
              </select>
            </div>
          </div>

          <div class="divider"></div>

          <div class="row">
            <label for="style">ç”»é¢¨</label>
            <select id="style">
              <option value="corporate">ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ãƒˆï¼ˆæ¸…æ½”ãƒ»ä¿¡é ¼ï¼‰</option>
              <option value="flat">ãƒ•ãƒ©ãƒƒãƒˆå›³è§£ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰</option>
              <option value="pict">ãƒ”ã‚¯ãƒˆ/ã‚¢ã‚¤ã‚³ãƒ³å›³è§£</option>
              <option value="isometric">ã‚¢ã‚¤ã‚½ãƒ¡å›³è§£</option>
              <option value="cel">ã‚»ãƒ«å¡—ã‚Šã‚¢ãƒ‹ãƒ¡</option>
              <option value="pastel3d">3Dãƒ‘ã‚¹ãƒ†ãƒ«</option>
              <option value="loose">ã‚†ã‚‹ã„ã‚¤ãƒ©ã‚¹ãƒˆ</option>
              <option value="hand">æ‰‹æ›¸ãé¢¨</option>
            </select>
          </div>

          <div class="two">
            <div class="row" style="margin-bottom:0;">
              <label for="tone">ãƒˆãƒ¼ãƒ³</label>
              <select id="tone">
                <option value="business">ãƒ“ã‚¸ãƒã‚¹å¯„ã‚Šï¼ˆè½ã¡ç€ãï¼‰</option>
                <option value="friendly">è¦ªã—ã¿ï¼ˆã‚„ã‚ã‚‰ã‹ï¼‰</option>
                <option value="energetic">å‹¢ã„ï¼ˆå…ƒæ°—ï¼‰</option>
                <option value="luxury">é«˜ç´šæ„Ÿï¼ˆä¸Šå“ï¼‰</option>
              </select>
            </div>
            <div class="row" style="margin-bottom:0;">
              <label for="bg">èƒŒæ™¯</label>
              <select id="bg">
                <option value="white">ç™½ï¼ˆä½™ç™½å¤šã‚ï¼‰</option>
                <option value="lightGrad">è–„ã„ã‚°ãƒ©ãƒ‡</option>
                <option value="darkGrad">æ¿ƒã„ã‚ã‚°ãƒ©ãƒ‡</option>
                <option value="solid">å˜è‰²</option>
                <option value="photo">å†™çœŸ/ãƒªã‚¢ãƒ«èƒŒæ™¯</option>
              </select>
            </div>
          </div>

          <div class="row" style="margin-top:10px;">
            <label for="color">é…è‰²</label>
            <select id="color">
              <option value="brand">ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼å„ªå…ˆ</option>
              <option value="mono">ãƒ¢ãƒãƒˆãƒ¼ãƒ³</option>
              <option value="pastel">ãƒ‘ã‚¹ãƒ†ãƒ«</option>
              <option value="vivid">ãƒ“ãƒ“ãƒƒãƒ‰</option>
              <option value="earth">ã‚¢ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼</option>
            </select>
          </div>

          <div class="row">
            <label for="textAmount">æ–‡å­—é‡</label>
            <select id="textAmount">
              <option value="short">å°‘ãªã‚ï¼ˆå¤§ããèª­ã¿ã‚„ã™ãï¼‰</option>
              <option value="mid">ä¸­ãã‚‰ã„</option>
              <option value="more">å¤šã‚ï¼ˆå›³è§£å‘ãï¼‰</option>
            </select>
          </div>

          <div class="row">
            <label for="quality">ä»•ä¸ŠãŒã‚Š</label>
            <select id="quality">
              <option value="clean">ã‚¯ãƒªãƒ¼ãƒ³ï¼ˆãƒã‚¤ã‚ºå°‘ï¼‰</option>
              <option value="rich">ãƒªãƒƒãƒï¼ˆæƒ…å ±é‡å¤šï¼‰</option>
              <option value="simple">ãƒŸãƒ‹ãƒãƒ«</option>
            </select>
          </div>

          <p class="hint">
            â€»ã€Œä½•ã‚’ä½œã‚‹ã‹ã€ã€Œæ¯”ç‡ã€ã€Œã‚¿ã‚¤ãƒˆãƒ«ä½ç½®ã€ã€Œãƒˆãƒ¼ãƒ³ã€ã€Œè‰²ã€ã‚ãŸã‚Šã‚’ã½ã¡ã½ã¡ã™ã‚‹æƒ³å®šã§ã™ã€‚<br/>
            è¶³ã‚Šãªã„æŒ‡å®šã¯AIãŒè£œå®Œã™ã‚‹å‰æã§OKã§ã™ã€‚
          </p>
        </div>
      </section>

      <!-- RIGHT: Core info + Output -->
      <section class="card">
        <div class="hd">
          <div class="ttl">âœï¸ â‘¡ ãƒ‡ã‚¶ã‚¤ãƒ³ã‚³ã‚¢ï¼ˆæ—¥æœ¬èªã§OKï¼‰</div>
          <div class="pill">è‡ªå‹•ä¿å­˜: ON</div>
        </div>
        <div class="bd">
          <div class="row">
            <label for="title">ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆå¤§è¦‹å‡ºã—ï¼‰</label>
            <input id="title" type="text" placeholder="ä¾‹ï¼‰3åˆ†ã§ã‚ã‹ã‚‹GASè‡ªå‹•åŒ– / å¤±æ•—ã—ãªã„ã‚µãƒ¼ãƒãƒ¼ãƒ©ãƒƒã‚¯ä½œæ¥­" />
          </div>

          <div class="row">
            <label for="subtitle">ã‚µãƒ–ã‚³ãƒ”ãƒ¼ï¼ˆä»»æ„ï¼‰</label>
            <input id="subtitle" type="text" placeholder="ä¾‹ï¼‰ç¾å ´ã§è©°ã¾ã‚ŠãŒã¡ãªãƒã‚¤ãƒ³ãƒˆã ã‘" />
          </div>

          <div class="two">
            <div class="row" style="margin-bottom:0;">
              <label for="audience">æƒ³å®šèª­è€…/è¦–è´è€…</label>
              <input id="audience" type="text" placeholder="ä¾‹ï¼‰æ–°äººCE / æƒ…ã‚·ã‚¹æ‹…å½“ / çµŒå–¶è€…" />
            </div>
            <div class="row" style="margin-bottom:0;">
              <label for="goal">è¦‹ã›ãŸã„å°è±¡</label>
              <input id="goal" type="text" placeholder="ä¾‹ï¼‰ä¿¡é ¼ãƒ»ç°¡å˜ãƒ»ã™ãä½¿ãˆã‚‹" />
            </div>
          </div>

          <div class="row" style="margin-top:10px;">
            <label for="message">ä¼ãˆãŸã„è¦ç‚¹ï¼ˆç®‡æ¡æ›¸ãã§OKï¼‰</label>
            <textarea id="message" placeholder="ä¾‹ï¼‰
ãƒ»çµè«–ï¼šã¾ãšã“ã‚Œã ã‘ã‚„ã‚‹
ãƒ»å¤±æ•—ä¾‹ã¨å›é¿ç­–
ãƒ»æ‰‹é † 1â†’2â†’3
ãƒ»æ³¨æ„ç‚¹ï¼ˆå®‰å…¨/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰"></textarea>
          </div>

          <div class="two">
            <div class="row" style="margin-bottom:0;">
              <label for="characters">ç™»å ´äººç‰©/è¦ç´ </label>
              <input id="characters" type="text" placeholder="ä¾‹ï¼‰ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢1äººã€PCã€ã‚µãƒ¼ãƒãƒ¼ãƒ©ãƒƒã‚¯ã€ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ" />
            </div>
            <div class="row" style="margin-bottom:0;">
              <label for="brandColor">ãƒ–ãƒ©ãƒ³ãƒ‰è‰²ï¼ˆä»»æ„ï¼‰</label>
              <input id="brandColor" type="text" placeholder="ä¾‹ï¼‰#4f46e5 / é’ç³»" />
            </div>
          </div>

          <div class="row" style="margin-top:10px;">
            <label for="constraints">åˆ¶ç´„/NGï¼ˆä»»æ„ï¼‰</label>
            <textarea id="constraints" placeholder="ä¾‹ï¼‰
ãƒ»æ–‡å­—ã¯èª­ã¿ã‚„ã™ãå¤ªå­—
ãƒ»ä½™ç™½å¤šã‚
ãƒ»èƒŒæ™¯ã¯ç™½å¯„ã‚Š
ãƒ»å°ã•ã„æ–‡å­—ã¯é¿ã‘ã‚‹
ãƒ»ç‰ˆæ¨©ã‚­ãƒ£ãƒ©ä¸å¯"></textarea>
          </div>

          <div class="divider"></div>

          <div class="mini-actions">
            <button class="btn-accent" id="btnCopy">ğŸ“‹ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ã‚³ãƒ”ãƒ¼</button>
            <button class="btn-green" id="btnDownload">ğŸ’¾ .txtã§ä¿å­˜</button>
            <button id="btnShorten">ğŸª„ æ–‡å­—é‡ã‚’åœ§ç¸®ï¼ˆé›°å›²æ°—ï¼‰</button>
          </div>

          <div class="status" style="margin-top:10px;">
            <span>æ–‡å­—æ•°: <b id="charCount">0</b></span>
            <span>æ¨å¥¨: <span class="kbd">ã‚¿ã‚¤ãƒˆãƒ«</span>ï¼‹<span class="kbd">è¦ç‚¹</span>ã ã‘ã§ã‚‚å¯</span>
            <span id="warnArea"></span>
          </div>

          <div class="divider"></div>

          <div class="hd" style="padding:0; border:none; margin-bottom:10px;">
            <div class="ttl" style="font-weight:900;">ğŸ§¾ â‘¢ å‡ºåŠ›ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆã‚³ãƒ”ãƒšç”¨ï¼‰</div>
            <div class="pill" id="modePill">Mode: æŒ‡ç¤ºãƒ†ãƒ³ãƒ—ãƒ¬</div>
          </div>

          <div class="prompt" id="promptOut" aria-label="ç”Ÿæˆã•ã‚ŒãŸãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ"></div>

          <div class="hint" style="margin-top:10px;">
            ä½¿ã„æ–¹ï¼šã“ã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã¦ã€ç”ŸæˆçµæœãŒã‚ºãƒ¬ãŸã‚‰ <span class="kbd">åˆ¶ç´„</span> ã«ä¸€è¨€è¿½è¨˜ â†’ ã‚‚ã†ä¸€å›ã€ã®ãƒ«ãƒ¼ãƒ—ãŒæ—©ã„ã§ã™ã€‚
          </div>

          <div style="margin-top:10px;">
            <span class="tag">#ã‚µãƒ ãƒ</span>
            <span class="tag">#å›³è§£</span>
            <span class="tag">#æ¼«ç”»</span>
            <span class="tag">#ãƒãƒŠãƒ¼</span>
            <span class="tag">#æ—¥æœ¬èªã§OK</span>
          </div>
        </div>
      </section>
    </div>
  </main>

  <div class="footer">
    ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ: <span class="kbd">Ctrl</span> + <span class="kbd">Enter</span> ã§ã‚³ãƒ”ãƒ¼ / <span class="kbd">Esc</span> ã§è­¦å‘Šè¡¨ç¤ºãƒªã‚»ãƒƒãƒˆ
  </div>

  <div class="toast" id="toast">ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼</div>

<script>
(() => {
  const $ = (id) => document.getElementById(id);

  const els = {
    purpose: $("purpose"),
    ratio: $("ratio"),
    layout: $("layout"),
    style: $("style"),
    tone: $("tone"),
    bg: $("bg"),
    color: $("color"),
    textAmount: $("textAmount"),
    quality: $("quality"),

    title: $("title"),
    subtitle: $("subtitle"),
    audience: $("audience"),
    goal: $("goal"),
    message: $("message"),
    characters: $("characters"),
    brandColor: $("brandColor"),
    constraints: $("constraints"),

    presetPill: $("presetPill"),
    modePill: $("modePill"),
    promptOut: $("promptOut"),
    charCount: $("charCount"),
    warnArea: $("warnArea"),
    toast: $("toast"),

    btnCopy: $("btnCopy"),
    btnCopyTop: $("btnCopyTop"),
    btnReset: $("btnReset"),
    btnRandom: $("btnRandom"),
    btnDownload: $("btnDownload"),
    btnShorten: $("btnShorten"),
  };

  const STORAGE_KEY = "nanobanana_generator_vibe_v1";

  const dict = {
    purpose: {
      thumbnail: "ã‚µãƒ ãƒã‚¤ãƒ«ï¼ˆYouTube/ãƒ–ãƒ­ã‚°ï¼‰",
      diagram: "å›³è§£ï¼ˆ1æšã§è¦ç‚¹ï¼‰",
      compare: "æ¯”è¼ƒå›³è§£ï¼ˆA/Bï¼‰",
      beforeAfter: "Before/After å›³è§£",
      steps: "ã‚¹ãƒ†ãƒƒãƒ—å›³è§£ï¼ˆæ‰‹é †ï¼‰",
      comic4: "4ã‚³ãƒæ¼«ç”»",
      banner: "ãƒãƒŠãƒ¼ç”»åƒ",
    },
    layout: { top:"ä¸Š", center:"ä¸­å¤®", bottom:"ä¸‹", left:"å·¦", right:"å³" },
    tone: { business:"ãƒ“ã‚¸ãƒã‚¹å¯„ã‚Š", friendly:"è¦ªã—ã¿", energetic:"å‹¢ã„", luxury:"é«˜ç´šæ„Ÿ" },
    bg: { white:"ç™½", lightGrad:"è–„ã„ã‚°ãƒ©ãƒ‡", darkGrad:"æ¿ƒã„ã‚ã‚°ãƒ©ãƒ‡", solid:"å˜è‰²", photo:"å†™çœŸ/ãƒªã‚¢ãƒ«" },
    color: { brand:"ãƒ–ãƒ©ãƒ³ãƒ‰ã‚«ãƒ©ãƒ¼å„ªå…ˆ", mono:"ãƒ¢ãƒãƒˆãƒ¼ãƒ³", pastel:"ãƒ‘ã‚¹ãƒ†ãƒ«", vivid:"ãƒ“ãƒ“ãƒƒãƒ‰", earth:"ã‚¢ãƒ¼ã‚¹ã‚«ãƒ©ãƒ¼" },
    textAmount: { short:"å°‘ãªã‚", mid:"ä¸­ãã‚‰ã„", more:"å¤šã‚" },
    quality: { clean:"ã‚¯ãƒªãƒ¼ãƒ³", rich:"ãƒªãƒƒãƒ", simple:"ãƒŸãƒ‹ãƒãƒ«" },
    style: {
      corporate:"ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ãƒˆï¼ˆæ¸…æ½”ãƒ»ä¿¡é ¼ï¼‰",
      flat:"ãƒ•ãƒ©ãƒƒãƒˆå›³è§£ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ï¼‰",
      pict:"ãƒ”ã‚¯ãƒˆ/ã‚¢ã‚¤ã‚³ãƒ³å›³è§£",
      isometric:"ã‚¢ã‚¤ã‚½ãƒ¡å›³è§£",
      cel:"ã‚»ãƒ«å¡—ã‚Šã‚¢ãƒ‹ãƒ¡",
      pastel3d:"3Dãƒ‘ã‚¹ãƒ†ãƒ«",
      loose:"ã‚†ã‚‹ã„ã‚¤ãƒ©ã‚¹ãƒˆ",
      hand:"æ‰‹æ›¸ãé¢¨",
    }
  };

  function toast(msg){
    els.toast.textContent = msg;
    els.toast.classList.add("show");
    setTimeout(()=>els.toast.classList.remove("show"), 1200);
  }

  function save(){
    const data = {};
    for(const k of Object.keys(els)){
      if(!els[k] || !("value" in els[k])) continue;
      data[k] = els[k].value;
    }
    localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
  }

  function load(){
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    try{
      const data = JSON.parse(raw);
      for(const [k,v] of Object.entries(data)){
        if(els[k] && ("value" in els[k])) els[k].value = v;
      }
    }catch(e){}
  }

  function recommendWarnings(){
    const t = els.title.value.trim();
    const m = els.message.value.trim();
    const p = els.purpose.value;

    let warns = [];
    if(!t) warns.push("ã‚¿ã‚¤ãƒˆãƒ«ãŒç©ºã§ã™");
    if(!m) warns.push("è¦ç‚¹ãŒç©ºã§ã™");
    if(p === "comic4" && !els.characters.value.trim()) warns.push("4ã‚³ãƒãªã‚‰ç™»å ´äººç‰©/è¦ç´ ãŒã‚ã‚‹ã¨å®‰å®šã—ã¾ã™");
    if((p === "compare" || p === "beforeAfter") && m.split("\n").filter(Boolean).length < 2) warns.push("æ¯”è¼ƒ/BeforeAfterã¯è¦ç‚¹ã‚’2è¡Œä»¥ä¸Šã«ã™ã‚‹ã¨å¼·ã„ã§ã™");
    if(els.textAmount.value === "more" && els.ratio.value === "16:9") warns.push("æ–‡å­—é‡å¤šã‚Ã—16:9 ã¯è©°ã¾ã‚Šã‚„ã™ã„ã®ã§ä½™ç™½/å›³å½¢ã§é€ƒãŒã™æŒ‡ç¤ºãŒãŠã™ã™ã‚ã§ã™");

    if(warns.length){
      els.warnArea.innerHTML = `âš ï¸ ${warns.join(" / ")}`;
      els.warnArea.style.color = "rgba(245,158,11,.95)";
    }else{
      els.warnArea.textContent = "âœ… å…¥åŠ›OK";
      els.warnArea.style.color = "rgba(34,197,94,.9)";
    }
  }

  function buildPrompt(){
    const purpose = els.purpose.value;
    const ratio = els.ratio.value;
    const layout = els.layout.value;
    const style = els.style.value;
    const tone = els.tone.value;
    const bg = els.bg.value;
    const color = els.color.value;
    const textAmount = els.textAmount.value;
    const quality = els.quality.value;

    const title = els.title.value.trim();
    const subtitle = els.subtitle.value.trim();
    const audience = els.audience.value.trim();
    const goal = els.goal.value.trim();
    const message = els.message.value.trim();
    const characters = els.characters.value.trim();
    const brandColor = els.brandColor.value.trim();
    const constraints = els.constraints.value.trim();

    els.presetPill.textContent = `Preset: ${dict.purpose[purpose]}`;
    els.modePill.textContent = `Mode: ${dict.style[style]} / ${ratio}`;

    const purposeGuide = (() => {
      switch(purpose){
        case "thumbnail":
          return [
            "è¦–èªæ€§æœ€å„ªå…ˆã€‚ã‚¿ã‚¤ãƒˆãƒ«ã¯å¤§ããã€è¦ç´ ã¯å°‘ãªãã€å¼·ã„ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆã§ã€‚",
            "é‡è¦å˜èªã‚’2ã€œ5èªã«çµã‚‹ã€‚å°ã•ã„æ–‡å­—ã¯é¿ã‘ã‚‹ã€‚",
            "ä½™ç™½ã‚’ç¢ºä¿ã—ã€èƒŒæ™¯ã¯ã†ã‚‹ã•ãã—ãªã„ã€‚"
          ].join("\n");
        case "diagram":
          return [
            "æƒ…å ±ã‚’æ•´ç†ã—ã¦ã€è¦‹å‡ºã—â†’è¦ç‚¹â†’è£œè¶³ã®é †ã§éšå±¤åŒ–ã€‚",
            "ã‚¢ã‚¤ã‚³ãƒ³/å›³å½¢/çŸ¢å°ã§ç†è§£ã‚’åŠ©ã‘ã‚‹ã€‚æ–‡ç« ã¯çŸ­ãã€‚",
          ].join("\n");
        case "compare":
          return [
            "Aã¨Bã‚’å·¦å³ã¾ãŸã¯ä¸Šä¸‹ã§å¯¾æ¯”ã€‚å·®åˆ†ãŒä¸€ç›®ã§ã‚ã‹ã‚‹æ§‹æˆã€‚",
            "æ¯”è¼ƒè»¸ã‚’2ã€œ4å€‹ã«çµã£ã¦å›³è§£åŒ–ã€‚",
          ].join("\n");
        case "beforeAfter":
          return [
            "Beforeã¨Afterã‚’æ˜ç¢ºã«åˆ†é›¢ã—ã€å¤‰åŒ–ç‚¹ã‚’å¼·èª¿ã€‚",
            "çŸ¢å°ã‚„ãƒã‚¤ãƒ©ã‚¤ãƒˆã§ã€Œã©ã“ãŒã©ã†è‰¯ããªã‚‹ã‹ã€ã‚’è¦‹ã›ã‚‹ã€‚",
          ].join("\n");
        case "steps":
          return [
            "1â†’2â†’3â€¦ã®æµã‚ŒãŒè¿·å­ã«ãªã‚‰ãªã„ã‚ˆã†ã€ç•ªå·ãƒ»çŸ¢å°ã§èª˜å°ã€‚",
            "å„ã‚¹ãƒ†ãƒƒãƒ—ã¯çŸ­æ–‡ï¼‹ã‚¢ã‚¤ã‚³ãƒ³ã§ã€‚",
          ].join("\n");
        case "comic4":
          return [
            "4ã‚³ãƒæ§‹æˆï¼ˆèµ·â†’æ‰¿â†’è»¢â†’çµï¼‰ã€‚ã‚ªãƒã¯æœ€å¾Œã«ã€‚",
            "ã‚»ãƒªãƒ•ã¯çŸ­ãã€è¡¨æƒ…ã§æ„Ÿæƒ…ãŒä¼ã‚ã‚‹ã‚ˆã†ã«ã€‚",
          ].join("\n");
        case "banner":
          return [
            "æ¨ªé•·ãƒãƒŠãƒ¼æƒ³å®šã€‚ä½™ç™½ãƒ»è¦–èªæ€§ãƒ»CTAï¼ˆä»»æ„ï¼‰ã‚’æ„è­˜ã€‚",
            "æƒ…å ±ã¯æœ€å°ã€‚ä¸»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸1æœ¬ï¼‹è£œåŠ©1æœ¬ã¾ã§ã€‚",
          ].join("\n");
        default:
          return "";
      }
    })();

    const titlePos = (() => {
      const map = {
        top: "ã‚¿ã‚¤ãƒˆãƒ«ã¯ä¸Šéƒ¨ã«é…ç½®",
        center: "ã‚¿ã‚¤ãƒˆãƒ«ã¯ä¸­å¤®ã«é…ç½®ï¼ˆæœ€å„ªå…ˆã§ç›®ç«‹ãŸã›ã‚‹ï¼‰",
        bottom: "ã‚¿ã‚¤ãƒˆãƒ«ã¯ä¸‹éƒ¨ã«é…ç½®ï¼ˆäººç‰©/ä¸»å½¹ã®é‚ªé­”ã‚’ã—ãªã„ï¼‰",
        left: "ã‚¿ã‚¤ãƒˆãƒ«ã¯å·¦å´ï¼ˆç¸¦çµ„ã¿ã‚‚å¯ï¼‰ã«é…ç½®",
        right: "ã‚¿ã‚¤ãƒˆãƒ«ã¯å³å´ã«é…ç½®"
      };
      return map[layout] || "ã‚¿ã‚¤ãƒˆãƒ«ä½ç½®ã¯é©åˆ‡ã«";
    })();

    const colorLine = (() => {
      let s = `é…è‰²ã¯ã€Œ${dict.color[color]}ã€ã‚’åŸºèª¿ã«ã€‚`;
      if(brandColor) s += ` ãƒ–ãƒ©ãƒ³ãƒ‰è‰²ã¯ã€Œ${brandColor}ã€ã‚’å„ªå…ˆã€‚`;
      return s;
    })();

    const bgLine = `èƒŒæ™¯ã¯ã€Œ${dict.bg[bg]}ã€ã€‚ãƒˆãƒ¼ãƒ³ã¯ã€Œ${dict.tone[tone]}ã€ã€‚ä»•ä¸ŠãŒã‚Šã¯ã€Œ${dict.quality[quality]}ã€ã€‚æ–‡å­—é‡ã¯ã€Œ${dict.textAmount[textAmount]}ã€ã€‚`;

    const coreBlock = [
      title ? `ã€ã‚¿ã‚¤ãƒˆãƒ«ã€‘${title}` : "ã€ã‚¿ã‚¤ãƒˆãƒ«ã€‘ï¼ˆæœªå…¥åŠ›ï¼šçŸ­ãå¼·ã„è¨€è‘‰ã«ï¼‰",
      subtitle ? `ã€ã‚µãƒ–ã‚³ãƒ”ãƒ¼ã€‘${subtitle}` : null,
      audience ? `ã€å¯¾è±¡ã€‘${audience}` : null,
      goal ? `ã€ç‹™ã„ã€‘${goal}` : null,
      characters ? `ã€ç™»å ´äººç‰©/è¦ç´ ã€‘${characters}` : null,
      message ? `ã€ä¼ãˆãŸã„è¦ç‚¹ã€‘\n${message}` : "ã€ä¼ãˆãŸã„è¦ç‚¹ã€‘\nï¼ˆæœªå…¥åŠ›ï¼šç®‡æ¡æ›¸ãã§OKï¼‰",
      constraints ? `ã€åˆ¶ç´„/NGã€‘\n${constraints}` : null
    ].filter(Boolean).join("\n\n");

    const prompt =
`ã‚ãªãŸã¯ä¸€æµã®ãƒ“ã‚¸ãƒ¥ã‚¢ãƒ«ãƒ‡ã‚¶ã‚¤ãƒŠãƒ¼å…¼ã€ç”»åƒç”ŸæˆAIã¸ã®æŒ‡ç¤ºä½œæˆã®å°‚é–€å®¶ã§ã™ã€‚
æ¬¡ã®è¦ä»¶ã‚’æº€ãŸã™ã€Œ${dict.purpose[purpose]}ã€ã®ç”»åƒã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

ã€ä»•æ§˜ï¼ˆå›ºå®šï¼‰ã€‘
- ç”»åƒæ¯”ç‡: ${ratio}
- ç”»é¢¨: ${dict.style[style]}
- ${titlePos}
- ${bgLine}
- ${colorLine}

ã€ãƒ‡ã‚¶ã‚¤ãƒ³æ–¹é‡ã€‘
${purposeGuide}
- æ–‡å­—ã¯ã€Œèª­ã¿ã‚„ã™ã•ã€æœ€å„ªå…ˆã€‚é‡è¦èªã¯å¤ªã‚ãƒ»å¤§ãã‚ã€‚
- ä½™ç™½ã‚’å–ã‚Šã€è¦ç´ ã‚’è©°ã‚è¾¼ã¿ã™ããªã„ã€‚
- æ„å›³ãŒä¼ã‚ã‚‹æ§‹å›³ãƒ»è¦–ç·šèª˜å°ï¼ˆçŸ¢å°/æ /ç•ªå·/å¼·èª¿ï¼‰ã‚’å…¥ã‚Œã‚‹ã€‚
- æ–‡å­—ã¯æ—¥æœ¬èªã§è‡ªç„¶ã«ã€‚èª¤å­—ã‚’é¿ã‘ã‚‹ã€‚
- ãƒ­ã‚´ã‚„å•†æ¨™ãƒ»ç‰ˆæ¨©ã‚­ãƒ£ãƒ©ãªã©ã€æ¨©åˆ©ç‰©ã¯å«ã‚ãªã„ã€‚

ã€å†…å®¹ï¼ˆã‚³ã‚¢æƒ…å ±ï¼‰ã€‘
${coreBlock}

ã€å‡ºåŠ›ã®ã‚³ãƒ„ã€‘
- ã‚‚ã—æƒ…å ±ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã¯ã€æ–‡è„ˆã‹ã‚‰è‡ªç„¶ã«è£œå®Œã—ã¦ã‚ˆã„ã€‚
- ãŸã ã—ã€Œè¦‹å‡ºã—èªã€ã‚’å‹æ‰‹ã«å¢—ã‚„ã—ã™ããšã€ä¸»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒãƒ–ãƒ¬ãªã„ã‚ˆã†ã«ã€‚`;

    els.promptOut.textContent = prompt;

    const count = prompt.length;
    els.charCount.textContent = String(count);

    recommendWarnings();
  }

  async function copyPrompt(){
    const text = els.promptOut.textContent || "";
    try{
      await navigator.clipboard.writeText(text);
      toast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼");
    }catch(e){
      const ta = document.createElement("textarea");
      ta.value = text;
      document.body.appendChild(ta);
      ta.select();
      document.execCommand("copy");
      ta.remove();
      toast("ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸï¼ˆäº’æ›ãƒ¢ãƒ¼ãƒ‰ï¼‰ï¼");
    }
  }

  function downloadTxt(){
    const text = els.promptOut.textContent || "";
    const blob = new Blob([text], {type:"text/plain;charset=utf-8"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "nanobanana_prompt.txt";
    document.body.appendChild(a);
    a.click();
    a.remove();
    URL.revokeObjectURL(url);
    toast(".txt ã‚’ä¿å­˜ã—ã¾ã—ãŸ");
  }

  function resetAll(){
    localStorage.removeItem(STORAGE_KEY);
    els.purpose.value = "thumbnail";
    els.ratio.value = "16:9";
    els.layout.value = "center";
    els.style.value = "corporate";
    els.tone.value = "business";
    els.bg.value = "white";
    els.color.value = "brand";
    els.textAmount.value = "short";
    els.quality.value = "clean";

    els.title.value = "";
    els.subtitle.value = "";
    els.audience.value = "";
    els.goal.value = "";
    els.message.value = "";
    els.characters.value = "";
    els.brandColor.value = "";
    els.constraints.value = "";

    buildPrompt();
    toast("ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ");
  }

  function randomFill(){
    const samples = [
      {
        title:"3åˆ†ã§ã‚ã‹ã‚‹GASè‡ªå‹•åŒ–",
        subtitle:"å¤±æ•—ã—ãªã„æœ€çŸ­ãƒ«ãƒ¼ãƒˆ",
        audience:"ãƒ—ãƒ­ã‚°ãƒ©ãƒ è‹¦æ‰‹ãªç¤¾å†…ãƒ¡ãƒ³ãƒãƒ¼",
        goal:"ç°¡å˜ãƒ»ä¿¡é ¼ãƒ»ã™ãä½¿ãˆã‚‹",
        message:"ãƒ»çµè«–ï¼šã¾ãšãƒ†ãƒ³ãƒ—ãƒ¬ã‚’ã‚³ãƒ”ãƒ¼\nãƒ»æ¬¡ã«ç½®æ›â†’PDFå‡ºåŠ›\nãƒ»æ¨©é™/ãƒˆãƒªã‚¬ãƒ¼ã§ã¤ã¾ãšããŒã¡\nãƒ»é‹ç”¨ãƒ«ãƒ¼ãƒ«ã‚’å…ˆã«æ±ºã‚ã‚‹",
        characters:"ã‚†ã‚‹ã„äººç‰©1äººã€ãƒãƒ¼ãƒˆPCã€æ­¯è»Šã‚¢ã‚¤ã‚³ãƒ³ã€ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ",
        constraints:"ãƒ»èƒŒæ™¯ã¯ç™½å¯„ã‚Š\nãƒ»æ–‡å­—ã¯å¤ªã‚ã§èª­ã¿ã‚„ã™ã\nãƒ»ã‚¢ã‚¤ã‚³ãƒ³ã§ç†è§£è£œåŠ©\nãƒ»å°ã•ã„æ–‡å­—ã¯é¿ã‘ã‚‹"
      },
      {
        title:"æ–°äººCEãŒæœ€åˆã«è¦šãˆã‚‹ã“ã¨",
        subtitle:"ç¾å ´ã§è©°ã¾ã‚‰ãªã„ã‚³ãƒ„",
        audience:"æ–°äºº/è‹¥æ‰‹ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢",
        goal:"è¦ªã—ã¿ãƒ»å®‰å¿ƒãƒ»å®Ÿç”¨",
        message:"ãƒ»å®‰å…¨ï¼ˆæ„Ÿé›»/è»¢å€’ï¼‰\nãƒ»ç¢ºèªé †ï¼ˆé›»æºâ†’é…ç·šâ†’ãƒ­ã‚°ï¼‰\nãƒ»å ±å‘Šã®å‹ï¼ˆçµè«–â†’çŠ¶æ³â†’å¯¾å¿œï¼‰\nãƒ»å†ç™ºé˜²æ­¢ãƒ¡ãƒ¢",
        characters:"ä½œæ¥­å“¡ã€å·¥å…·ã€æ³¨æ„ãƒãƒ¼ã‚¯ã€ãƒ¡ãƒ¢å¸³",
        constraints:"ãƒ»æ‰‹æ›¸ãé¢¨ã§ã‚‚èª­ã¿ã‚„ã™ã•å„ªå…ˆ\nãƒ»ä½™ç™½å¤šã‚\nãƒ»é‡è¦èªã¯è‰²ã§å¼·èª¿"
      },
      {
        title:"Before / Afterã§ä¼ãˆã‚‹æ”¹å–„",
        subtitle:"è¦‹ãˆã‚‹åŒ–ã§ç´å¾—æ„ŸUP",
        audience:"ç®¡ç†è·/ç¾å ´ãƒªãƒ¼ãƒ€ãƒ¼",
        goal:"èª¬å¾—åŠ›ãƒ»æ•´ç†ãƒ»ç´å¾—",
        message:"Beforeï¼šå±äººçš„ãƒ»æ‰‹å…¥åŠ›ãƒ»ãƒŸã‚¹å¤š\nAfterï¼šãƒ•ã‚©ãƒ¼ãƒ åŒ–ãƒ»è‡ªå‹•é›†è¨ˆãƒ»å¯è¦–åŒ–\nåŠ¹æœï¼šå·¥æ•°30%å‰Šæ¸›ã€æ¼ã‚Œã‚¼ãƒ­",
        characters:"å·¦ã«å›°ã‚Šé¡”ã€å³ã«ç¬‘é¡”ã€çŸ¢å°ã€ã‚°ãƒ©ãƒ•",
        constraints:"ãƒ»æ¯”è¼ƒãŒä¸€ç›®ã§ã‚ã‹ã‚‹å·¦å³åˆ†å‰²\nãƒ»ã‚¢ã‚¤ã‚³ãƒ³ã¨çŸ­æ–‡ä¸­å¿ƒ\nãƒ»ã‚³ãƒ¼ãƒãƒ¬ãƒ¼ãƒˆæ„Ÿ"
      }
    ];

    const s = samples[Math.floor(Math.random()*samples.length)];
    els.title.value = s.title;
    els.subtitle.value = s.subtitle;
    els.audience.value = s.audience;
    els.goal.value = s.goal;
    els.message.value = s.message;
    els.characters.value = s.characters;
    els.constraints.value = s.constraints;

    const styles = ["corporate","flat","pict","isometric","cel","pastel3d","loose","hand"];
    els.style.value = styles[Math.floor(Math.random()*styles.length)];
    const purposes = ["thumbnail","diagram","beforeAfter","compare","steps","comic4","banner"];
    els.purpose.value = purposes[Math.floor(Math.random()*purposes.length)];

    els.ratio.value = els.purpose.value === "banner" ? "21:9"
                 : els.purpose.value === "comic4" ? "1:1"
                 : els.purpose.value === "steps" ? "9:16"
                 : "16:9";

    buildPrompt();
    toast("ãã‚Œã£ã½ãåŸ‹ã‚ã¾ã—ãŸ");
  }

  function shortenVibe(){
    const compress = (txt) => {
      const lines = txt.split("\n").map(l=>l.trim()).filter(Boolean);
      const kept = lines.slice(0, 5).map(l=>{
        return l.length > 42 ? l.slice(0, 42) + "â€¦" : l;
      });
      return kept.join("\n");
    };

    if(els.message.value.trim()) els.message.value = compress(els.message.value);
    if(els.constraints.value.trim()) els.constraints.value = compress(els.constraints.value);
    buildPrompt();
    toast("åœ§ç¸®ã—ã¾ã—ãŸ");
  }

  const allInputs = [
    els.purpose, els.ratio, els.layout, els.style, els.tone, els.bg, els.color, els.textAmount, els.quality,
    els.title, els.subtitle, els.audience, els.goal, els.message, els.characters, els.brandColor, els.constraints
  ];
  allInputs.forEach(el => el.addEventListener("input", () => { save(); buildPrompt(); }));
  allInputs.forEach(el => el.addEventListener("change", () => { save(); buildPrompt(); }));

  els.btnCopy.addEventListener("click", copyPrompt);
  els.btnCopyTop.addEventListener("click", copyPrompt);
  els.btnDownload.addEventListener("click", downloadTxt);
  els.btnReset.addEventListener("click", resetAll);
  els.btnRandom.addEventListener("click", randomFill);
  els.btnShorten.addEventListener("click", shortenVibe);

  window.addEventListener("keydown", (e) => {
    if((e.ctrlKey || e.metaKey) && e.key === "Enter"){
      e.preventDefault();
      copyPrompt();
    }
    if(e.key === "Escape"){
      els.warnArea.textContent = "";
      toast("è¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ");
    }
  });

  load();
  buildPrompt();
})();
</script>
</body>
</html>
